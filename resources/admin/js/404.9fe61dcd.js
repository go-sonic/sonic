"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[404],{32404:function(e,t,a){a.r(t),a.d(t,{default:function(){return O}});var s=function(){var e=this,t=e._self._c;return t("page-view",[t("a-row",{attrs:{gutter:12}},[t("a-col",{staticClass:"mb-3",attrs:{lg:6,md:6,sm:24,xl:6,xs:24}},[t("a-card",{attrs:{bodyStyle:{padding:"16px"},title:"分组"},scopedSlots:e._u([{key:"extra",fn:function(){return[t("ReactiveButton",{attrs:{errored:e.teams.default.errored,loading:e.teams.default.saving,erroredText:"设置失败",loadedText:"设置成功",text:"设为默认",type:"default"},on:{callback:e.handleSetDefaultTeamCallback,click:e.handleSetDefaultTeam}})]},proxy:!0}])},[t("div",{staticClass:"menu-teams"},[t("a-spin",{attrs:{spinning:e.teams.loading}},[0!==e.teams.data.length||e.teams.loading?e._e():t("a-empty"),e.teams.data.length>0?t("a-menu",{staticClass:"w-full",attrs:{mode:"inline"},on:{select:e.handleSelectedTeam},model:{value:e.selectedTeam,callback:function(t){e.selectedTeam=t},expression:"selectedTeam"}},e._l(e.teams.data,(function(a){return t("a-menu-item",{key:a},[e._v(" "+e._s(""===a?"未分组":a)+e._s(e.defaultMenuTeam===a?"（默认）":"")+" ")])})),1):e._e()],1)],1),t("a-popover",{attrs:{destroyTooltipOnHide:"",placement:"bottom",title:"新增分组",trigger:"click"},on:{visibleChange:e.handleTeamFormVisibleChange},scopedSlots:e._u([{key:"content",fn:function(){return[t("a-form-model",{ref:"teamForm",attrs:{model:e.teams.form.model,rules:e.teams.form.rules},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCreateTeam.apply(null,arguments)}}},[t("a-form-model-item",{attrs:{prop:"team"}},[t("a-input",{attrs:{autoFocus:""},model:{value:e.teams.form.model.team,callback:function(t){e.$set(e.teams.form.model,"team",t)},expression:"teams.form.model.team"}})],1),t("a-form-model-item",{staticStyle:{"margin-bottom":"0"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleCreateTeam}},[e._v(" 新增")])],1)],1)]},proxy:!0}]),model:{value:e.teams.form.visible,callback:function(t){e.$set(e.teams.form,"visible",t)},expression:"teams.form.visible"}},[t("a-button",{staticClass:"mt-3",attrs:{block:"",type:"primary"}},[e._v(" 新增分组")])],1)],1)],1),t("a-col",{staticClass:"pb-3",attrs:{lg:18,md:18,sm:24,xl:18,xs:24}},[t("a-card",{attrs:{bodyStyle:{padding:"16px"}},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.menuListTitle)+" "),e.list.data.length<=0&&!e.list.loading?t("a-tooltip",{attrs:{slot:"action",title:"分组下的菜单为空时，该分组也不会保存"},slot:"action"},[t("a-icon",{staticClass:"cursor-pointer",attrs:{type:"info-circle-o"}})],1):e._e()]},proxy:!0},{key:"extra",fn:function(){return[t("a-space",[t("ReactiveButton",{attrs:{disabled:e.list.data.length<=0,errored:e.formBatch.errored,loading:e.formBatch.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存"},on:{callback:function(t){e.formBatch.errored=!1},click:e.handleUpdateBatch}}),e.form.visible?t("a-button",{attrs:{type:"default"},on:{click:function(t){return e.handleCloseCreateMenuForm()}}},[e._v(" 取消新增")]):t("a-button",{attrs:{ghost:"",type:"primary"},on:{click:function(t){return e.handleOpenCreateMenuForm()}}},[e._v(" 新增")]),t("a-dropdown",{attrs:{trigger:["click"]},scopedSlots:e._u([{key:"overlay",fn:function(){return[t("a-menu",[t("a-menu-item",{on:{click:function(t){e.menuInternalLinkSelector.visible=!0}}},[e._v(" 从系统预设链接添加")]),t("a-menu-item",{on:{click:e.handleOpenUpdateTeamForm}},[e._v(" 重命名分组")]),t("a-menu-item",{on:{click:e.handleDeleteBatch}},[e._v(" 删除当前组")])],1)]},proxy:!0}])},[t("a-button",[e._v(" 其他 "),t("a-icon",{attrs:{type:"down"}})],1)],1)],1)]},proxy:!0}])},[t("a-spin",{attrs:{spinning:e.list.loading}},[e.form.visible?t("MenuForm",{attrs:{menu:e.form.model},on:{cancel:function(t){return e.handleCloseCreateMenuForm()},succeed:function(t){return e.handleCreateMenuSucceed()}}}):e._e(),0!==e.list.data.length||e.list.loading||e.form.visible?e._e():t("a-empty"),t("MenuTreeNode",{attrs:{excludedTeams:e.excludedTeams},on:{reload:e.handleListMenus},model:{value:e.list.data,callback:function(t){e.$set(e.list,"data",t)},expression:"list.data"}})],1)],1)],1)],1),t("MenuInternalLinkSelector",{attrs:{team:e.teams.selected},on:{reload:e.handleListMenus},model:{value:e.menuInternalLinkSelector.visible,callback:function(t){e.$set(e.menuInternalLinkSelector,"visible",t)},expression:"menuInternalLinkSelector.visible"}}),t("a-modal",{attrs:{title:"重命名分组"},scopedSlots:e._u([{key:"footer",fn:function(){return[t("ReactiveButton",{attrs:{errored:e.updateTeamForm.saveErrored,loading:e.updateTeamForm.saving,erroredText:"更改失败",loadedText:"更改成功",text:"确定"},on:{callback:e.handleUpdateTeamInBatchCallback,click:e.handleUpdateTeamInBatch}}),t("a-button",{on:{click:function(t){e.updateTeamForm.visible=!1}}},[e._v("关闭")])]},proxy:!0}]),model:{value:e.updateTeamForm.visible,callback:function(t){e.$set(e.updateTeamForm,"visible",t)},expression:"updateTeamForm.visible"}},[t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"分组名称："}},[t("a-input",{ref:"teamInput",staticStyle:{width:"100%"},attrs:{allowClear:""},model:{value:e.updateTeamForm.team,callback:function(t){e.$set(e.updateTeamForm,"team",t)},expression:"updateTeamForm.team"}})],1)],1)],1)],1)},n=[],l=(a(70560),a(70571)),i=function(){var e=this,t=e._self._c;return t("a-list",{attrs:{"item-layout":"horizontal"}},[t("draggable",e._b({staticClass:"item-container",attrs:{list:e.list,value:e.value,handle:".mover",tag:"div"},on:{end:function(t){e.isDragging=!1},input:e.emitter,start:function(t){e.isDragging=!0}}},"draggable",e.dragOptions,!1),[t("transition-group",e._l(e.realValue,(function(a){return t("div",{key:a.id},[t("a-list-item",{staticClass:"menu-item"},[t("a-list-item-meta",[t("span",{staticClass:"inline-block font-bold title",attrs:{slot:"title"},slot:"title"},[t("a-icon",{staticClass:"cursor-pointer mover",attrs:{type:"bars"}}),e._v(" "+e._s(a.name)+" "),"_blank"===a.target?t("a-tooltip",{attrs:{title:"外部链接"}},[t("a-icon",{attrs:{type:"link"}})],1):e._e(),e._v(" "+e._s(a.formVisible?"（正在编辑）":"")+" ")],1),t("span",{staticClass:"inline-block",attrs:{slot:"description"},slot:"description"},[t("a",{staticClass:"ant-anchor-link-title",attrs:{href:a.url,target:"_blank"}},[e._v(" "+e._s(a.url)+" ")])])]),t("template",{slot:"actions"},[a.formVisible?t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleCloseCreateMenuForm(a)}}},[e._v("取消编辑")]):t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleOpenEditForm(a)}}},[e._v(" 编辑 ")])],1),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleDelete(a.id)}}},[e._v("删除")])],1),e.excludedTeams&&e.excludedTeams.length>0?t("template",{slot:"actions"},[t("a-dropdown",{attrs:{trigger:["click"]}},[t("a",{staticClass:"ant-dropdown-link",on:{click:e=>e.preventDefault()}},[e._v(" 更多 "),t("a-icon",{attrs:{type:"down"}})],1),t("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[t("a-sub-menu",{attrs:{title:"移动到分组"}},e._l(e.excludedTeams,(function(s,n){return t("a-menu-item",{key:n,on:{click:function(t){return e.handleMoveMenu(a,s)}}},[e._v(e._s(""===s?"未分组":s)+" ")])})),1)],1)],1)],1):e._e()],2),a.formVisible?t("MenuForm",{attrs:{menu:a},on:{cancel:function(t){return e.handleCloseCreateMenuForm(a)},succeed:function(t){return e.handleUpdateMenuSucceed(a)}}}):e._e(),t("div",{staticClass:"a-list-nested",staticStyle:{"margin-left":"44px"}},[t("MenuTreeNode",{attrs:{excludedTeams:e.excludedTeams,list:a.children},on:{reload:e.onReloadEmit}})],1)],1)})),0)],1)],1)},r=[],o=a(9980),m=a.n(o),u=function(){var e=this,t=e._self._c;return t("div",[t("a-form-model",{ref:"menuForm",attrs:{model:e.menuModel,rules:e.form.rules,labelAlign:"left"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCreateOrUpdateMenu.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{lg:8,md:12,sm:12,xl:8,xs:12}},[t("a-form-model-item",{attrs:{help:"* 页面上所显示的名称",label:"名称",prop:"name"}},[t("a-input",{attrs:{autoFocus:""},model:{value:e.menuModel.name,callback:function(t){e.$set(e.menuModel,"name",t)},expression:"menuModel.name"}})],1)],1),t("a-col",{attrs:{lg:8,md:12,sm:12,xl:8,xs:12}},[t("a-form-model-item",{attrs:{help:"* 菜单的地址",label:"地址",prop:"url"}},[t("a-input",{model:{value:e.menuModel.url,callback:function(t){e.$set(e.menuModel,"url",t)},expression:"menuModel.url"}})],1)],1),t("a-col",{attrs:{lg:8,md:12,sm:12,xl:8,xs:12}},[t("a-form-model-item",{attrs:{help:"* 请根据主题的支持情况选填",label:"图标",prop:"icon"}},[t("a-input",{model:{value:e.menuModel.icon,callback:function(t){e.$set(e.menuModel,"icon",t)},expression:"menuModel.icon"}})],1)],1),t("a-col",{attrs:{lg:8,md:12,sm:12,xl:8,xs:12}},[t("a-form-model-item",{attrs:{label:"打开方式",prop:"target"}},[t("a-radio-group",{attrs:{options:e.targets},model:{value:e.menuModel.target,callback:function(t){e.$set(e.menuModel,"target",t)},expression:"menuModel.target"}})],1)],1),t("a-col",{attrs:{lg:8,md:12,sm:12,xl:8,xs:12}},[t("a-form-model-item",{attrs:{colon:!1,label:" "}},[t("a-space",[t("ReactiveButton",{attrs:{errored:e.form.errored,loading:e.form.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存",type:"primary"},on:{callback:e.handleSavedCallback,click:e.handleCreateOrUpdateMenu}}),t("a-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)],1)],1)],1)],1)},d=[],c=a(80068);const h=[{value:"_self",label:"当前窗口"},{value:"_blank",label:"新窗口"}];var p={name:"MenuForm",model:{prop:"menu",event:"input"},props:{menu:{type:Object,default:()=>({})}},computed:{menuModel:{get(){return this.menu},set(e){this.$emit("input",e)}},isUpdateMode(){return!!this.menuModel.id}},data(){return{targets:h,form:{rules:{name:[{required:!0,message:"* 菜单名称不能为空",trigger:["change"]},{max:50,message:"* 菜单名称的字符长度不能超过 50",trigger:["change"]}],url:[{required:!0,message:"* 菜单地址不能为空",trigger:["change"]},{max:1023,message:"* 菜单地址的字符长度不能超过 1023",trigger:["change"]}],icon:[{max:50,message:"* 菜单图标的字符长度不能超过 50",trigger:["change"]}]},saving:!1,errored:!1}}},methods:{handleCreateOrUpdateMenu(){const e=this;e.$refs.menuForm.validate((t=>{t&&(e.form.saving=!0,e.isUpdateMode?c.Z.menu.update(e.menuModel.id,e.menuModel).catch((()=>{e.form.errored=!0})).finally((()=>{setTimeout((()=>{e.form.saving=!1}),400)})):c.Z.menu.create(e.menuModel).catch((()=>{e.form.errored=!0})).finally((()=>{setTimeout((()=>{e.form.saving=!1}),400)})))}))},handleSavedCallback(){const e=this;e.form.errored?e.form.errored=!1:(e.menuModel={target:"_self"},e.$emit("succeed"))},handleCancel(){this.$emit("cancel")}}},f=p,g=a(1001),v=(0,g.Z)(f,u,d,!1,null,null,null),b=v.exports,y=a(16879),k={name:"MenuTreeNode",components:{draggable:m(),MenuForm:b},props:{value:{required:!1,type:Array,default:null},list:{required:!1,type:Array,default:null},excludedTeams:{required:!1,type:Array,default:null}},data(){return{isDragging:!1}},computed:{dragOptions(){return{animation:300,group:"description",ghostClass:"ghost",chosenClass:"chosen",dragClass:"drag",emptyInsertThreshold:20}},realValue(){return this.value?this.value:this.list}},methods:{emitter(e){this.$emit("input",e)},handleDelete(e){const t=this;t.$confirm({title:"提示",content:"确定要删除当前菜单？",onOk(){c.Z.menu.delete(e).finally((()=>{t.onReloadEmit()}))}})},handleOpenEditForm(e){this.$set(e,"formVisible",!0)},handleUpdateMenuSucceed(e){this.handleCloseCreateMenuForm(e)},handleCloseCreateMenuForm(e){this.$set(e,"formVisible",!1)},async handleMoveMenu(e,t){const a=(0,y.I8)(e);a.team=t,a.parentId=0,a.priority=0;const s=e=>e&&0!==e.length?e.reduce(((e,a)=>{const n=a.children.length>0?s(a.children):[];return a.team=t,[...e,a,...n]}),[]):[],n=[a,...s(a.children)];this.$log.debug("menu list as flat list:",n);try{await c.Z.menu.updateInBatch(n),this.$emit("reload")}catch(l){this.$log.error("Fail to update menu in batch",l)}},onReloadEmit(){this.$emit("reload")}}},C=k,M=(0,g.Z)(C,i,r,!1,null,"bf844320",null),_=M.exports,T=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{bodyStyle:{padding:"0 24px 24px"},width:1024,title:"从系统预设链接添加菜单"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("template",{slot:"footer"},[t("a-button",{on:{click:e.handleCancel}},[e._v(" 取消")]),t("ReactiveButton",{attrs:{disabled:e.menus&&e.menus.length<=0,errored:e.saveErrored,loading:e.saving,erroredText:"添加失败",loadedText:"添加成功",text:"添加"},on:{callback:e.handleCreateBatchCallback,click:e.handleCreateBatch}})],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{span:12}},[t("a-spin",{attrs:{spinning:e.loading}},[t("div",{staticClass:"custom-tab-wrapper"},[t("a-tabs",{attrs:{animated:{inkBar:!0,tabPane:!1},"default-active-key":"1"}},[t("a-tab-pane",{key:"1",attrs:{"force-render":"",tab:"分类目录"}},[t("a-list",{attrs:{"item-layout":"horizontal"}},e._l(e.categories,(function(a,s){return t("a-list-item",{key:s},[t("a-list-item-meta",{attrs:{description:a.fullPath,title:a.name}}),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleInsertPre(a.name,a.fullPath)}}},[t("a-icon",{attrs:{type:"plus-circle"}})],1)],1)],2)})),1)],1),t("a-tab-pane",{key:"2",attrs:{tab:"标签"}},[t("a-list",{attrs:{"item-layout":"horizontal"}},e._l(e.tags,(function(a,s){return t("a-list-item",{key:s},[t("a-list-item-meta",{attrs:{description:a.fullPath,title:a.name}}),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleInsertPre(a.name,a.fullPath)}}},[t("a-icon",{attrs:{type:"plus-circle"}})],1)],1)],2)})),1)],1),t("a-tab-pane",{key:"3",attrs:{tab:"独立页面"}},[t("a-list",{attrs:{"item-layout":"horizontal"}},e._l(e.sheet.independents,(function(a,s){return t("a-list-item",{key:s},[t("a-list-item-meta",{attrs:{description:a.fullPath,title:a.title}}),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleInsertPre(a.title,a.fullPath)}}},[t("a-icon",{attrs:{type:"plus-circle"}})],1)],1)],2)})),1)],1),t("a-tab-pane",{key:"4",attrs:{tab:"自定义页面"}},[t("a-list",{attrs:{"item-layout":"horizontal"}},e._l(e.sheet.customs.data,(function(a,s){return t("a-list-item",{key:s},[t("a-list-item-meta",{attrs:{description:a.fullPath,title:a.title}}),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleInsertPre(a.title,a.fullPath)}}},[t("a-icon",{attrs:{type:"plus-circle"}})],1)],1)],2)})),1),t("div",{staticClass:"page-wrapper"},[t("a-pagination",{staticClass:"pagination",attrs:{current:e.sheet.customs.pagination.page,defaultPageSize:e.sheet.customs.pagination.size,pageSizeOptions:["10","20","50","100"],total:e.sheet.customs.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:e.handleSheetPaginationChange,showSizeChange:e.handleSheetPaginationChange}})],1)],1),t("a-tab-pane",{key:"5",attrs:{tab:"其他"}},[t("a-list",{attrs:{"item-layout":"horizontal"}},e._l(e.otherInternalLinks,(function(a,s){return t("a-list-item",{key:s},[t("a-list-item-meta",{attrs:{description:a.url,title:a.name}}),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleInsertPre(a.name,a.url)}}},[t("a-icon",{attrs:{type:"plus-circle"}})],1)],1)],2)})),1)],1)],1)],1)])],1),t("a-col",{attrs:{span:12}},[t("div",{staticClass:"custom-tab-wrapper"},[t("a-tabs",{attrs:{"default-active-key":"1"}},[t("a-tab-pane",{key:"1",attrs:{"force-render":"",tab:"备选"}},[t("a-list",{attrs:{"item-layout":"horizontal"}},e._l(e.menus,(function(a,s){return t("a-list-item",{key:s},[t("a-list-item-meta",{attrs:{description:a.url,title:a.name}}),t("template",{slot:"actions"},[t("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(t){return e.handleRemovePre(s)}}},[t("a-icon",{attrs:{type:"close-circle"}})],1)],1)],2)})),1)],1)],1)],1)])],1)],2)},x=[],F={name:"MenuInternalLinkSelector",props:{value:{type:Boolean,default:!1},team:{type:String,default:""}},data(){return{options:{},categories:[],tags:[],menus:[],sheet:{independents:[],customs:{data:[],pagination:{page:1,size:10,sort:null,total:1},queryParam:{page:0,size:10,sort:null}}},loading:!1,saving:!1,saveErrored:!1}},computed:{visible:{get(){return this.value},set(e){this.$emit("input",e)}},otherInternalLinks(){const e=this.options,t=this.options.path_suffix?this.options.path_suffix:"";return[{name:"分类目录",url:`${e.blog_url}/${e.categories_prefix}${t}`},{name:"标签",url:`${e.blog_url}/${e.tags_prefix}${t}`},{name:"文章归档",url:`${e.blog_url}/${e.archives_prefix}${t}`},{name:"RSS",url:`${e.blog_url}/atom.xml`},{name:"网站地图",url:`${e.blog_url}/sitemap.xml`},{name:"网站地图",url:`${e.blog_url}/sitemap.html`}]}},watch:{visible(e){e&&(this.handleFetchAll(),this.handleListSheets())}},methods:{handleFetchAll(){this.loading=!0,Promise.all([c.Z.option.listAsMapView(),c.Z.category.list({sort:[],more:!1}),c.Z.tag.list({more:!1}),c.Z.sheet.listIndependents()]).then((e=>{this.options=e[0].data,this.categories=e[1].data,this.tags=e[2].data,this.sheet.independents=e[3].data})).finally((()=>{this.loading=!1}))},handleListSheets(){this.sheet.customs.queryParam.page=this.sheet.customs.pagination.page-1,this.sheet.customs.queryParam.size=this.sheet.customs.pagination.size,this.sheet.customs.queryParam.sort=this.sheet.customs.pagination.sort,c.Z.sheet.list(this.sheet.customs.queryParam).then((e=>{this.sheet.customs.data=e.data.content,this.sheet.customs.pagination.total=e.data.total}))},handleSheetPaginationChange(e,t){this.sheet.customs.pagination.page=e,this.sheet.customs.pagination.size=t,this.handleListSheets()},handleInsertPre(e,t){this.menus.push({name:e,url:t,team:this.team})},handleRemovePre(e){this.menus.splice(e,1)},handleCancel(){this.menus=[],this.visible=!1,this.$emit("reload")},handleCreateBatch(){this.saving=!0,c.Z.menu.createInBatch(this.menus).catch((()=>{this.saveErrored=!1})).finally((()=>{setTimeout((()=>{this.saving=!1}),400)}))},handleCreateBatchCallback(){this.saveErrored?this.saveErrored=!1:this.handleCancel()}}},S=F,$=(0,g.Z)(S,T,x,!1,null,null,null),I=$.exports,L=a(20629),B={components:{PageView:l.B4,MenuTreeNode:_,MenuForm:b,MenuInternalLinkSelector:I},data(){return{list:{data:[],loading:!1},form:{visible:!1,model:{}},formBatch:{saving:!1,errored:!1},teams:{data:[],loading:!1,selected:null,form:{visible:!1,model:{team:null},rules:{team:[{required:!0,message:"分组名称不能为空",trigger:["change"]}]}},default:{saving:!1,errored:!1}},updateTeamForm:{team:void 0,visible:!1,saving:!1,saveErrored:!1},menuInternalLinkSelector:{visible:!1}}},computed:{...(0,L.Se)(["options"]),computedMenusMoved(){const e=(0,y.I8)(this.list.data);return this.handleMenuMoved(0,e)},computedMenusWithoutLevel(){return this.handleGetMenusWithoutLevel(this.computedMenusMoved,[])},computedMenuIds(){return this.computedMenusWithoutLevel.map((e=>e.id))},selectedTeam:{get(){return[this.teams.selected]},set(e){this.teams.selected=e[0]}},menuListTitle(){return""===this.teams.selected?"未分组":this.teams.selected},excludedTeams(){return this.teams.data.filter((e=>e!==this.teams.selected))},defaultMenuTeam(){return this.options.default_menu_team?this.options.default_menu_team:""}},created(){this.handleListTeams()},methods:{...(0,L.nv)(["refreshOptionsCache"]),handleListTeams(e=!1){this.teams.loading=!0,c.Z.menu.listTeams().then((t=>{this.teams.data=t.data,this.teams.selected&&!e||(this.teams.selected=this.teams.data[0]),this.handleListMenus()})).finally((()=>{this.teams.loading=!1}))},handleListMenus(){this.list.data=[],this.list.loading=!0,c.Z.menu.listTreeViewByTeam(this.teams.selected).then((e=>{this.list.data=e.data})).finally((()=>{this.list.loading=!1}))},handleMenuMoved(e,t){for(let a=0;a<t.length;a++)t[a].priority=a,t[a].parentId=e,t[a].team=this.teams.selected,t[a].children&&t[a].children.length>0&&this.handleMenuMoved(t[a].id,t[a].children);return t},handleGetMenusWithoutLevel(e,t){for(let a=0;a<e.length;a++){t.push(e[a]);const s=e[a].children;s.length>0&&this.handleGetMenusWithoutLevel(s,t)}return t},handleSelectedTeam({key:e}){this.teams.selected=e,this.handleCloseCreateMenuForm(),this.handleListMenus()},handleUpdateBatch(){this.formBatch.saving=!0,c.Z.menu.updateInBatch(this.computedMenusWithoutLevel).catch((()=>{this.formBatch.errored=!0})).finally((()=>{setTimeout((()=>{this.formBatch.saving=!1,this.handleListMenus()}),400)}))},handleDeleteBatch(){const e=this;e.$confirm({title:"提示",content:"确定要删除当前分组以及所有菜单？",onOk(){c.Z.menu.deleteInBatch(e.computedMenuIds).finally((()=>{e.handleListTeams(!0)}))}})},handleTeamFormVisibleChange(e){e&&(this.teams.form.model.team=null)},handleCreateTeam(){const e=this;e.$refs.teamForm.validate((t=>{t&&(e.teams.data.includes(e.teams.form.model.team)||e.teams.data.push(e.teams.form.model.team),e.teams.selected=e.teams.form.model.team,e.teams.form.visible=!1,e.handleListMenus())}))},handleOpenCreateMenuForm(){this.form.visible=!0,this.form.model={team:this.teams.selected,target:"_self"}},handleCloseCreateMenuForm(){this.form.visible=!1,this.form.model={}},handleCreateMenuSucceed(){this.handleCloseCreateMenuForm(),this.handleListMenus()},handleSetDefaultTeam(){this.teams.default.saving=!0,c.Z.option.saveMapView({default_menu_team:this.teams.selected}).catch((()=>{this.teams.default.errored=!0})).finally((()=>{setTimeout((()=>{this.teams.default.saving=!1}),400)}))},handleSetDefaultTeamCallback(){this.teams.default.errored?this.teams.default.errored=!1:this.refreshOptionsCache()},handleOpenUpdateTeamForm(){this.updateTeamForm.team=this.teams.selected,this.updateTeamForm.visible=!0,this.$nextTick((()=>{this.$refs.teamInput.focus()}))},async handleUpdateTeamInBatch(){try{this.updateTeamForm.saving=!0,await c.Z.menu.updateInBatch(this.computedMenusWithoutLevel.map((e=>({...e,team:this.updateTeamForm.team})))),this.teams.selected===this.defaultMenuTeam&&(await c.Z.option.saveMapView({default_menu_team:this.updateTeamForm.team}),await this.refreshOptionsCache()),this.teams.selected=this.updateTeamForm.team}catch(e){this.updateTeamForm.saveErrored=!0,this.$log.debug("Failed update menus team",e)}finally{setTimeout((()=>{this.updateTeamForm.saving=!1}),400)}},handleUpdateTeamInBatchCallback(){this.updateTeamForm.saveErrored?this.updateTeamForm.saveErrored=!1:(this.handleListMenus(),this.handleListTeams(),this.updateTeamForm.visible=!1)}}},w=B,P=(0,g.Z)(w,s,n,!1,null,null,null),O=P.exports}}]);
(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[102],{9102:function(t,a,e){"use strict";e.r(a),e.d(a,{default:function(){return P}});var i=function(){var t=this,a=t._self._c;return a("page-view",[a("a-row",{attrs:{gutter:12}},[a("a-col",{staticClass:"mb-3",attrs:{lg:6,md:12,sm:12,xl:6,xs:12}},[a("analysis-card",{attrs:{number:t.statisticsData.postCount,title:"文章"},scopedSlots:t._u([{key:"action",fn:function(){return[a("router-link",{attrs:{to:{name:"PostWrite"}}},[t.statisticsLoading?a("a-icon",{attrs:{type:"loading"}}):a("a-icon",{attrs:{type:"plus"}})],1)]},proxy:!0}])})],1),a("a-col",{staticClass:"mb-3",attrs:{lg:6,md:12,sm:12,xl:6,xs:12}},[a("analysis-card",{attrs:{number:t.statisticsData.commentCount,title:"评论"},scopedSlots:t._u([{key:"action",fn:function(){return[a("router-link",{attrs:{to:{name:"Comments"}}},[t.statisticsLoading?a("a-icon",{attrs:{type:"loading"}}):a("a-icon",{attrs:{type:"unordered-list"}})],1)]},proxy:!0}])})],1),a("a-col",{staticClass:"mb-3",attrs:{lg:6,md:12,sm:12,xl:6,xs:12}},[a("analysis-card",{attrs:{number:t.statisticsData.visitCount,title:"阅读量"},scopedSlots:t._u([{key:"action",fn:function(){return[a("a-tooltip",{scopedSlots:t._u([{key:"title",fn:function(){return[t._v("文章阅读共 "+t._s(t.statisticsData.visitCount)+" 次")]},proxy:!0}])},[a("span",[t.statisticsLoading?a("a-icon",{attrs:{type:"loading"}}):a("a-icon",{attrs:{type:"info-circle-o"}})],1)])]},proxy:!0}])})],1),a("a-col",{staticClass:"mb-3",attrs:{lg:6,md:12,sm:12,xl:6,xs:12}},[a("analysis-card",{attrs:{number:t.statisticsData.establishDays,title:"建立天数"},scopedSlots:t._u([{key:"action",fn:function(){return[a("a-tooltip",{scopedSlots:t._u([{key:"title",fn:function(){return[t._v("博客建立于 "+t._s(t._f("moment")(t.statisticsData.birthday)))]},proxy:!0}])},[a("span",[t.statisticsLoading?a("a-icon",{attrs:{type:"loading"}}):a("a-icon",{attrs:{type:"info-circle-o"}})],1)])]},proxy:!0}])})],1)],1),a("a-row",{attrs:{gutter:12}},[a("a-col",{staticClass:"mb-3",attrs:{lg:8,md:12,sm:24,xl:8,xs:24}},[a("a-card",{attrs:{bodyStyle:{padding:0},bordered:!1,title:"新动态"}},[a("div",{staticClass:"card-container"},[a("a-tabs",{attrs:{type:"card"}},[a("a-tab-pane",{key:"1",attrs:{tab:"最近文章"}},[a("a-list",{attrs:{dataSource:t.latestPosts,loading:t.activityLoading},scopedSlots:t._u([{key:"renderItem",fn:function(e,i){return a("a-list-item",{key:i},[a("a-list-item-meta",{scopedSlots:t._u([{key:"title",fn:function(){return[["PUBLISHED","INTIMATE"].includes(e.status)?a("a",{attrs:{href:e.fullPath,target:"_blank"}},[t._v(" "+t._s(e.title)+" ")]):"DRAFT"===e.status?a("a",{attrs:{herf:"javascript:void(0)"},on:{click:function(a){return t.handlePostPreview(e.id)}}},[t._v(" "+t._s(e.title)+" ")]):"RECYCLE"===e.status?a("a",{attrs:{herf:"javascript:void(0)",disabled:""}},[t._v(" "+t._s(e.title)+" ")]):t._e()]},proxy:!0}],null,!0)}),a("div",[t._v(t._s(t._f("timeAgo")(e.createTime)))])],1)}}])})],1),a("a-tab-pane",{key:"2",attrs:{tab:"最近评论"}},[a("div",{staticClass:"custom-tab-wrapper"},[a("a-tabs",{attrs:{animated:{inkBar:!0,tabPane:!1}}},[a("a-tab-pane",{key:"posts",attrs:{tab:"文章"}},[a("recent-comment-tab",{attrs:{type:"posts"}})],1),a("a-tab-pane",{key:"sheets",attrs:{tab:"页面"}},[a("recent-comment-tab",{attrs:{type:"sheets"}})],1),a("a-tab-pane",{key:"journals",attrs:{tab:"日志"}},[a("recent-comment-tab",{attrs:{type:"journals"}})],1)],1)],1)])],1)],1)])],1),a("a-col",{staticClass:"mb-3",attrs:{lg:8,md:12,sm:24,xl:8,xs:24}},[a("JournalPublishCard")],1),a("a-col",{staticClass:"mb-3",attrs:{lg:8,md:12,sm:24,xl:8,xs:24}},[a("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[a("template",{slot:"title"},[t._v(" 操作日志 "),a("a-tooltip",{attrs:{slot:"action",title:"更多"},slot:"action"},[a("router-link",{attrs:{to:{name:"SystemActionLogs"}}},[a("a-icon",{attrs:{type:"ellipsis"}})],1)],1)],1),a("a-list",{attrs:{dataSource:t.latestLogs,loading:t.logLoading},scopedSlots:t._u([{key:"renderItem",fn:function(e,i){return a("a-list-item",{key:i},[a("a-list-item-meta",{attrs:{description:t._f("timeAgo")(e.createTime)}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t._f("typeConvert")(e.type)))])]),a("ellipsis",{attrs:{length:35,tooltip:""}},[t._v(t._s(e.content))])],1)}}])})],2)],1)],1)],1)},s=[],n=e(70571),r=function(){var t=this,a=t._self._c;return a("a-card",{attrs:{"body-style":{padding:"24px"},bordered:!1}},[a("div",{staticClass:"analysis-card-container"},[a("div",{staticClass:"meta"},[a("span",{staticClass:"analysis-card-title"},[t._t("title",(function(){return[t._v(t._s(t.title))]}))],2),a("span",{staticClass:"analysis-card-action"},[t._t("action")],2)]),a("div",{staticClass:"number"},[t._t("number",(function(){return[a("countTo",{attrs:{autoplay:!0,duration:3e3,endVal:"function"===typeof t.number&&t.number()||t.number,startVal:t.startNumber}})]}))],2)])])},o=[],l=e(37347),u=e.n(l),c={name:"AnalysisCard",components:{countTo:u()},props:{title:{type:String,required:!1,default:""},number:{type:Number,required:!1,default:0}},data(){return{startNumber:0}},watch:{number:function(t,a){this.startNumber=a}}},d=c,m=e(1001),p=(0,m.Z)(d,r,o,!1,null,null,null),h=p.exports,f=function(){var t=this,a=t._self._c;return a("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" 速记 "),a("a-tooltip",{attrs:{title:"内容将保存到页面/所有页面/日志页面"}},[a("router-link",{staticStyle:{color:"inherit"},attrs:{to:{name:"JournalList"}}},[a("a-icon",{staticClass:"cursor-pointer hover:text-blue-400 transition-all",attrs:{type:"info-circle-o"}})],1)],1)]},proxy:!0}])},[a("a-form-model",{ref:"journalForm",attrs:{model:t.form.model,rules:t.form.rules,layout:"vertical"}},[a("a-form-model-item",{attrs:{prop:"sourceContent"}},[a("a-input",{attrs:{autoSize:{minRows:8},placeholder:"写点什么吧...",type:"textarea"},model:{value:t.form.model.sourceContent,callback:function(a){t.$set(t.form.model,"sourceContent",a)},expression:"form.model.sourceContent"}})],1),a("a-form-model-item",[a("ReactiveButton",{attrs:{errored:t.form.errored,loading:t.form.saving,erroredText:"发布失败",loadedText:"发布成功",text:"发布"},on:{callback:()=>{t.form.errored||(t.form.model={}),t.form.errored=!1},click:t.handleCreateJournalClick}})],1)],1)],1)},y=[],b=e(80068),g={name:"JournalPublishCard",data(){return{form:{model:{},rules:{sourceContent:[{required:!0,message:"* 内容不能为空",trigger:["change"]}]},saving:!1,errored:!1}}},methods:{handleCreateJournalClick(){const t=this;t.$refs.journalForm.validate((a=>{a&&(t.form.saving=!0,b.Z.journal.create(t.form.model).catch((()=>{this.form.errored=!0})).finally((()=>{setTimeout((()=>{t.form.saving=!1}),400)})))}))}}},v=g,_=(0,m.Z)(v,f,y,!1,null,null,null),x=_.exports,V=function(){var t=this,a=t._self._c;return a("CommentListView",{attrs:{comments:t.comments,loading:t.loading}})},C=[],w={name:"RecentCommentTab",props:{type:{type:String,required:!1,default:"posts",validator:function(t){return-1!==["posts","sheets","journals"].indexOf(t)}}},data(){return{comments:[],loading:!1}},created(){this.handleListTargetComments()},methods:{async handleListTargetComments(){try{this.loading=!0;const{data:t}=await b.Z.comment.latest(this.type,5,"PUBLISHED");this.comments=t}catch(t){this.$log.error("Failed to load comments",t)}finally{this.loading=!1}}}},F=w,L=(0,m.Z)(F,V,C,!1,null,null,null),S=L.exports,k=e(32422),A={name:"Dashboard",components:{PageView:n.B4,AnalysisCard:h,JournalPublishCard:x,RecentCommentTab:S},data(){return{activityLoading:!1,logLoading:!1,statisticsLoading:!0,latestPosts:[],latestLogs:[],statisticsData:{},journal:{content:""},interval:null}},beforeMount(){this.handleLoadStatistics(),this.handleListLatestPosts(),this.handleListLatestLogs()},beforeRouteEnter(t,a,e){e((t=>{t.interval=setInterval((()=>{t.handleLoadStatistics()}),5e3)}))},beforeRouteLeave(t,a,e){this.interval&&(clearInterval(this.interval),this.interval=null,this.$log.debug("Cleared interval")),e()},methods:{handleListLatestPosts(){this.activityLoading=!0,b.Z.post.latest(5).then((t=>{this.latestPosts=t.data})).finally((()=>{this.activityLoading=!1}))},handleListLatestLogs(){this.logLoading=!0,b.Z.log.latest(5).then((t=>{this.latestLogs=t.data})).finally((()=>{this.logLoading=!1}))},handleLoadStatistics(){b.Z.statistic.statistics().then((t=>{this.statisticsData=t.data})).catch((()=>{clearInterval(this.interval)})).finally((()=>{this.statisticsLoading=!1}))},handlePostPreview(t){b.Z.post.getPreviewLinkById(t).then((t=>{window.open(t,"_blank")}))}},filters:{typeConvert(t){const a=k.Js[t];return a?a.text:t}}},D=A,q=(0,m.Z)(D,i,s,!1,null,null,null),P=q.exports},37347:function(t){!function(a,e){t.exports=e()}(0,(function(){return function(t){function a(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}var e={};return a.m=t,a.c=e,a.i=function(t){return t},a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},a.p="/dist/",a(a.s=2)}([function(t,a,e){var i=e(4)(e(1),e(5),null,null);t.exports=i.exports},function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e(3);a.default={props:{startVal:{type:Number,required:!1,default:0},endVal:{type:Number,required:!1,default:2017},duration:{type:Number,required:!1,default:3e3},autoplay:{type:Boolean,required:!1,default:!0},decimals:{type:Number,required:!1,default:0,validator:function(t){return t>=0}},decimal:{type:String,required:!1,default:"."},separator:{type:String,required:!1,default:","},prefix:{type:String,required:!1,default:""},suffix:{type:String,required:!1,default:""},useEasing:{type:Boolean,required:!1,default:!0},easingFn:{type:Function,default:function(t,a,e,i){return e*(1-Math.pow(2,-10*t/i))*1024/1023+a}}},data:function(){return{localStartVal:this.startVal,displayValue:this.formatNumber(this.startVal),printVal:null,paused:!1,localDuration:this.duration,startTime:null,timestamp:null,remaining:null,rAF:null}},computed:{countDown:function(){return this.startVal>this.endVal}},watch:{startVal:function(){this.autoplay&&this.start()},endVal:function(){this.autoplay&&this.start()}},mounted:function(){this.autoplay&&this.start(),this.$emit("mountedCallback")},methods:{start:function(){this.localStartVal=this.startVal,this.startTime=null,this.localDuration=this.duration,this.paused=!1,this.rAF=(0,i.requestAnimationFrame)(this.count)},pauseResume:function(){this.paused?(this.resume(),this.paused=!1):(this.pause(),this.paused=!0)},pause:function(){(0,i.cancelAnimationFrame)(this.rAF)},resume:function(){this.startTime=null,this.localDuration=+this.remaining,this.localStartVal=+this.printVal,(0,i.requestAnimationFrame)(this.count)},reset:function(){this.startTime=null,(0,i.cancelAnimationFrame)(this.rAF),this.displayValue=this.formatNumber(this.startVal)},count:function(t){this.startTime||(this.startTime=t),this.timestamp=t;var a=t-this.startTime;this.remaining=this.localDuration-a,this.useEasing?this.countDown?this.printVal=this.localStartVal-this.easingFn(a,0,this.localStartVal-this.endVal,this.localDuration):this.printVal=this.easingFn(a,this.localStartVal,this.endVal-this.localStartVal,this.localDuration):this.countDown?this.printVal=this.localStartVal-(this.localStartVal-this.endVal)*(a/this.localDuration):this.printVal=this.localStartVal+(this.localStartVal-this.startVal)*(a/this.localDuration),this.countDown?this.printVal=this.printVal<this.endVal?this.endVal:this.printVal:this.printVal=this.printVal>this.endVal?this.endVal:this.printVal,this.displayValue=this.formatNumber(this.printVal),a<this.localDuration?this.rAF=(0,i.requestAnimationFrame)(this.count):this.$emit("callback")},isNumber:function(t){return!isNaN(parseFloat(t))},formatNumber:function(t){t=t.toFixed(this.decimals),t+="";var a=t.split("."),e=a[0],i=a.length>1?this.decimal+a[1]:"",s=/(\d+)(\d{3})/;if(this.separator&&!this.isNumber(this.separator))for(;s.test(e);)e=e.replace(s,"$1"+this.separator+"$2");return this.prefix+e+i+this.suffix}},destroyed:function(){(0,i.cancelAnimationFrame)(this.rAF)}}},function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e(0),s=function(t){return t&&t.__esModule?t:{default:t}}(i);a.default=s.default,"undefined"!=typeof window&&window.Vue&&window.Vue.component("count-to",s.default)},function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=0,s="webkit moz ms o".split(" "),n=void 0,r=void 0;if("undefined"==typeof window)a.requestAnimationFrame=n=function(){},a.cancelAnimationFrame=r=function(){};else{a.requestAnimationFrame=n=window.requestAnimationFrame,a.cancelAnimationFrame=r=window.cancelAnimationFrame;for(var o=void 0,l=0;l<s.length&&(!n||!r);l++)o=s[l],a.requestAnimationFrame=n=n||window[o+"RequestAnimationFrame"],a.cancelAnimationFrame=r=r||window[o+"CancelAnimationFrame"]||window[o+"CancelRequestAnimationFrame"];n&&r||(a.requestAnimationFrame=n=function(t){var a=(new Date).getTime(),e=Math.max(0,16-(a-i)),s=window.setTimeout((function(){t(a+e)}),e);return i=a+e,s},a.cancelAnimationFrame=r=function(t){window.clearTimeout(t)})}a.requestAnimationFrame=n,a.cancelAnimationFrame=r},function(t,a){t.exports=function(t,a,e,i){var s,n=t=t||{},r=typeof t.default;"object"!==r&&"function"!==r||(s=t,n=t.default);var o="function"==typeof n?n.options:n;if(a&&(o.render=a.render,o.staticRenderFns=a.staticRenderFns),e&&(o._scopeId=e),i){var l=Object.create(o.computed||null);Object.keys(i).forEach((function(t){var a=i[t];l[t]=function(){return a}})),o.computed=l}return{esModule:s,exports:n,options:o}}},function(t,a){t.exports={render:function(){var t=this,a=t.$createElement;return(t._self._c||a)("span",[t._v("\n  "+t._s(t.displayValue)+"\n")])},staticRenderFns:[]}}])}))}}]);
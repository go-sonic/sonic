"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[430],{14430:function(e,t,l){l.r(t),l.d(t,{default:function(){return y}});var a=function(){var e=this,t=e._self._c;return t("page-view",{attrs:{title:e.activatedTheme?e.activatedTheme.name:"无",affix:"",subTitle:"当前启用"}},[t("template",{slot:"extra"},[t("a-button",{attrs:{loading:e.list.loading,icon:"reload"},on:{click:e.handleRefreshThemesCache}},[e._v(" 刷新")]),t("a-button",{attrs:{icon:"plus",type:"primary"},on:{click:function(t){e.installModal.visible=!0}}},[e._v(" 安装")])],1),t("a-row",{attrs:{gutter:12,align:"middle",type:"flex"}},[t("a-col",{attrs:{span:24}},[t("a-list",{attrs:{dataSource:e.sortedThemes,grid:{gutter:12,xs:1,sm:1,md:2,lg:4,xl:4,xxl:4},loading:e.list.loading},scopedSlots:e._u([{key:"renderItem",fn:function(l,a){return t("a-list-item",{key:a},[t("a-card",{attrs:{bodyStyle:{padding:0},title:l.name,hoverable:""}},[t("div",{staticClass:"theme-screenshot"},[t("img",{attrs:{alt:l.name,src:l.screenshots||"/images/placeholder.jpg",loading:"lazy"}})]),t("template",{slot:"actions"},[l.activated?t("div",[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{theme:"twoTone",type:"unlock"}}),e._v(" 已启用 ")],1):t("div",{on:{click:function(t){return e.handleActiveTheme(l)}}},[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"lock"}}),e._v(" 启用 ")],1),t("div",{on:{click:function(t){return e.handleRouteToThemeSetting(l)}}},[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"setting"}}),e._v(" 设置 ")],1),t("a-dropdown",{attrs:{trigger:["click"],placement:"topCenter"}},[t("a",{staticClass:"ant-dropdown-link",attrs:{href:"#"}},[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"ellipsis"}}),e._v(" 更多 ")],1),t("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[t("a-menu-item",{key:1,attrs:{disabled:l.activated},on:{click:function(t){return e.handleOpenThemeDeleteModal(l)}}},[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"delete"}}),e._v(" 删除 ")],1),l.repo?t("a-menu-item",{key:2,on:{click:function(t){return e.handleConfirmRemoteUpdate(l)}}},[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"cloud"}}),e._v(" 在线更新 ")],1):e._e(),t("a-menu-item",{key:3,on:{click:function(t){return e.handleOpenLocalUpdateModal(l)}}},[t("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"file"}}),e._v(" 本地更新 ")],1)],1)],1)],1)],2)],1)}}])})],1)],1),t("ThemeDeleteConfirmModal",{attrs:{theme:e.themeDeleteModal.selected,visible:e.themeDeleteModal.visible},on:{"update:visible":function(t){return e.$set(e.themeDeleteModal,"visible",t)},onAfterClose:function(t){e.themeDeleteModal.selected={}},success:e.handleListThemes}}),t("ThemeLocalUpgradeModal",{attrs:{theme:e.localUpgradeModel.selected,visible:e.localUpgradeModel.visible},on:{"update:visible":function(t){return e.$set(e.localUpgradeModel,"visible",t)},onAfterClose:function(t){e.localUpgradeModel.selected={}},success:e.handleListThemes}}),t("ThemeInstallModal",{attrs:{visible:e.installModal.visible},on:{"update:visible":function(t){return e.$set(e.installModal,"visible",t)},onAfterClose:e.handleListThemes}})],2)},i=[],o=(l(70560),l(92055)),s=l(51751),n=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{afterClose:e.onModalClose,bodyStyle:{padding:"0 24px 24px"},footer:null,destroyOnClose:"",title:"安装主题"},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("div",{staticClass:"custom-tab-wrapper"},[t("a-tabs",{attrs:{animated:{inkBar:!0,tabPane:!1}}},[t("a-tab-pane",{key:"1",attrs:{tab:"本地上传"}},[t("FilePondUpload",{ref:"upload",attrs:{accepts:["application/x-zip","application/x-zip-compressed","application/zip"],uploadHandler:e.local.uploadHandler,label:"点击选择主题包或将主题包拖拽到此处<br>仅支持 ZIP 格式的文件",name:"file"},on:{success:e.onUploadSucceed}}),t("div",{staticClass:"mt-5"},[t("a-alert",{attrs:{closable:"",type:"info"}},[t("template",{slot:"message"},[e._v(" 更多主题请访问： "),t("a",{attrs:{href:"https://github.com/go-sonic/sonic#theme-ecology",target:"_blank"}},[e._v("https://github.com/go-sonic/sonic#theme-ecology")])])],2)],1)],1),t("a-tab-pane",{key:"2",attrs:{tab:"远程下载(暂不支持)"}},[t("a-form-model",{ref:"remoteInstallForm",attrs:{model:e.remote,rules:e.remote.rules,layout:"vertical"}},[t("a-form-model-item",{attrs:{help:"* 支持 Git 仓库地址，ZIP 链接。",label:"远程地址：",prop:"url"}},[t("a-input",{model:{value:e.remote.url,callback:function(t){e.$set(e.remote,"url",t)},expression:"remote.url"}})],1),t("a-form-model-item",[t("ReactiveButton",{attrs:{errored:e.remote.fetchErrored,loading:e.remote.fetching,erroredText:"下载失败",loadedText:"下载成功",text:"下载",type:"primary"},on:{callback:e.handleRemoteFetchCallback,click:e.handleRemoteFetching}})],1)],1),t("div",{staticClass:"mt-5"},[t("a-alert",{attrs:{closable:"",type:"info"}},[t("template",{slot:"message"},[e._v(" 目前仅支持远程 Git 仓库和 ZIP 下载链接。更多主题请访问： "),t("a",{attrs:{href:"https://github.com/go-sonic/sonic#theme-ecology",target:"_blank"}},[e._v("https://github.com/go-sonic/sonic#theme-ecology")])])],2)],1)],1)],1)],1)])},r=[],d=l(80068),c={name:"ThemeInstallModal",props:{visible:{type:Boolean,default:!1}},data(){return{local:{uploadHandler:(e,t)=>d.Z.theme.upload(e,t)},remote:{url:null,fetching:!1,fetchErrored:!1,rules:{url:[{required:!0,message:"* 远程地址不能为空",trigger:["change"]}]}}}},computed:{modalVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},methods:{onModalClose(){this.$refs.upload.handleClearFileList(),this.remote.url=null,this.$emit("onAfterClose")},onUploadSucceed(){this.modalVisible=!1,this.$emit("upload-succeed")},handleRemoteFetching(){this.$refs.remoteInstallForm.validate((async e=>{if(e)try{this.remote.fetching=!0,await d.Z.theme.fetchTheme(this.remote.url)}catch(t){this.remote.fetchErrored=!0,this.$log.error("Fetch remote theme failed: ",t)}finally{setTimeout((()=>{this.remote.fetching=!1}),400)}}))},handleRemoteFetchCallback(){this.remote.fetchErrored?this.remote.fetchErrored=!1:this.modalVisible=!1}}},h=c,m=l(1001),u=(0,m.Z)(h,n,r,!1,null,null,null),p=u.exports,f=l(70571),g={components:{PageView:f.B4,ThemeDeleteConfirmModal:o.Z,ThemeLocalUpgradeModal:s.Z,ThemeInstallModal:p},data(){return{list:{loading:!1,data:[]},installModal:{visible:!1},localUpgradeModel:{visible:!1,selected:{}},themeDeleteModal:{visible:!1,selected:{}}}},computed:{sortedThemes(){const e=this.list.data.slice(0);return e.sort(((e,t)=>t.activated-e.activated))},activatedTheme(){return this.sortedThemes.length>0?this.sortedThemes[0]:null}},beforeMount(){this.handleListThemes()},methods:{handleListThemes(){this.list.loading=!0,d.Z.theme.list().then((e=>{this.list.data=e.data})).finally((()=>{this.list.loading=!1}))},handleRefreshThemesCache(){d.Z.theme.reload().finally((()=>{this.handleListThemes()}))},handleActiveTheme(e){d.Z.theme.active(e.id).finally((()=>{this.handleListThemes()}))},handleOpenLocalUpdateModal(e){this.localUpgradeModel.selected=e,this.localUpgradeModel.visible=!0},handleRouteToThemeSetting(e){this.$router.push({name:"ThemeSetting",query:{themeId:e.id}})},handleOpenThemeDeleteModal(e){this.themeDeleteModal.visible=!0,this.themeDeleteModal.selected=e},handleConfirmRemoteUpdate(e){const t=this;t.$confirm({title:"提示",maskClosable:!0,content:"确定更新【"+e.name+"】主题？",async onOk(){const l=t.$message.loading("更新中...",0);try{await d.Z.theme.updateThemeByFetching(e.id),t.$message.success("更新成功！")}catch(a){t.$log.error("Failed to update theme: ",a)}finally{l(),t.handleListThemes()}}})}}},b=g,v=(0,m.Z)(b,a,i,!1,null,null,null),y=v.exports},92055:function(e,t,l){l.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{afterClose:e.onAfterClose,closable:!1,width:416,destroyOnClose:"",title:"提示"},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("template",{slot:"footer"},[t("a-button",{on:{click:function(t){e.modalVisible=!1}}},[e._v(" 取消 ")]),t("ReactiveButton",{attrs:{errored:e.deleteErrored,loading:e.deleting,erroredText:"删除失败",loadedText:"删除成功",text:"确定"},on:{callback:e.handleDeleteCallback,click:function(t){return e.handleDelete()}}})],1),t("p",[e._v("确定删除【"+e._s(e.theme.name)+"】主题？")]),t("a-checkbox",{model:{value:e.deleteSettings,callback:function(t){e.deleteSettings=t},expression:"deleteSettings"}},[e._v(" 同时删除主题配置 ")])],2)},i=[],o=l(80068),s={name:"ThemeDeleteConfirmModal",props:{visible:{type:Boolean,default:!1},theme:{type:Object,default:()=>({})}},data(){return{deleteErrored:!1,deleting:!1,deleteSettings:!1}},computed:{modalVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},methods:{async handleDelete(){try{this.deleting=!0,await o.Z.theme.delete(this.theme.id,this.deleteSettings)}catch(e){this.deleteErrored=!1,this.$log.error("Delete theme failed",e)}finally{setTimeout((()=>{this.deleting=!1}),400)}},handleDeleteCallback(){this.deleteErrored?this.deleteErrored=!1:(this.modalVisible=!1,this.$emit("success"))},onAfterClose(){this.deleteErrored=!1,this.deleting=!1,this.deleteSettings=!1,this.$emit("onAfterClose")}}},n=s,r=l(1001),d=(0,r.Z)(n,a,i,!1,null,null,null),c=d.exports},51751:function(e,t,l){l.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{afterClose:e.onModalClose,footer:null,destroyOnClose:"",title:"更新主题"},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("FilePondUpload",{ref:"updateByFile",attrs:{accepts:["application/x-zip","application/x-zip-compressed","application/zip"],field:e.theme.id,multiple:!1,uploadHandler:e.uploadHandler,label:"点击选择主题更新包或将主题更新包拖拽到此处<br>仅支持 ZIP 格式的文件",name:"file"},on:{success:e.onThemeUploadSuccess}})],1)},i=[],o=l(80068),s={name:"ThemeLocalUpgradeModal",props:{visible:{type:Boolean,default:!1},theme:{type:Object,default:()=>({})}},data(){return{uploadHandler:(e,t,l)=>o.Z.theme.updateByUpload(e,t,l)}},computed:{modalVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},methods:{onModalClose(){this.$refs.updateByFile.handleClearFileList(),this.$emit("onAfterClose")},onThemeUploadSuccess(){this.modalVisible=!1,this.$emit("success")}}},n=s,r=l(1001),d=(0,r.Z)(n,a,i,!1,null,null,null),c=d.exports}}]);
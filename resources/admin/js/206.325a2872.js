"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[206],{86399:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var o=function(){var e=this,t=e._self._c;return t("page-view",[t("a-row",{attrs:{gutter:12}},[t("a-col",{staticClass:"pb-3",attrs:{lg:10,md:10,sm:24,xl:10,xs:24}},[t("a-card",{attrs:{bodyStyle:{padding:"16px"},title:e.title}},[t("a-form-model",{ref:"tagForm",attrs:{model:e.form.model,rules:e.form.rules,layout:"horizontal"}},[t("a-form-model-item",{attrs:{help:"* 页面上所显示的名称",label:"名称：",prop:"name"}},[t("a-input",{model:{value:e.form.model.name,callback:function(t){e.$set(e.form.model,"name",t)},expression:"form.model.name"}})],1),t("a-form-model-item",{attrs:{help:"* 一般为单个标签页面的标识，最好为英文",label:"别名：",prop:"slug"}},[t("a-input",{model:{value:e.form.model.slug,callback:function(t){e.$set(e.form.model,"slug",t)},expression:"form.model.slug"}})],1),t("a-form-model-item",{attrs:{label:"颜色：",prop:"color"}},[t("a-input",{scopedSlots:e._u([{key:"addonAfter",fn:function(){return[t("verte",{staticStyle:{cursor:"pointer"},attrs:{model:"hex",picker:"square"},model:{value:e.form.model.color,callback:function(t){e.$set(e.form.model,"color",t)},expression:"form.model.color"}})]},proxy:!0}]),model:{value:e.form.model.color,callback:function(t){e.$set(e.form.model,"color",t)},expression:"form.model.color"}})],1),t("a-form-model-item",{attrs:{help:"* 在标签页面可展示，需要主题支持",label:"封面图：",prop:"thumbnail"}},[t("AttachmentInput",{attrs:{title:"选择封面图"},model:{value:e.form.model.thumbnail,callback:function(t){e.$set(e.form.model,"thumbnail",t)},expression:"form.model.thumbnail"}})],1),t("a-form-model-item",[e.isUpdateMode?t("a-button-group",[t("ReactiveButton",{attrs:{errored:e.form.errored,loading:e.form.saving,erroredText:"更新失败",loadedText:"更新成功",text:"更新",type:"primary"},on:{callback:e.handleSavedCallback,click:e.handleCreateOrUpdateTag}}),t("a-button",{attrs:{type:"dashed"},on:{click:function(t){e.form.model={}}}},[e._v("返回添加")])],1):t("ReactiveButton",{attrs:{errored:e.form.errored,loading:e.form.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存",type:"primary"},on:{callback:e.handleSavedCallback,click:e.handleCreateOrUpdateTag}}),e.isUpdateMode?t("a-popconfirm",{attrs:{title:"你确定要删除【"+e.form.model.name+"】标签？",cancelText:"取消",okText:"确定"},on:{confirm:function(t){return e.handleDeleteTag(e.form.model.id)}}},[t("a-button",{staticClass:"float-right",attrs:{type:"danger"}},[e._v("删除")])],1):e._e()],1)],1)],1)],1),t("a-col",{staticClass:"pb-3",attrs:{lg:14,md:14,sm:24,xl:14,xs:24}},[t("a-card",{attrs:{bodyStyle:{padding:"16px"},title:"所有标签"},scopedSlots:e._u([{key:"extra",fn:function(){return[t("a",{staticClass:"p-0 m-0",attrs:{href:"javascript:void(0)"},on:{click:e.handleCleanup}},[e._v("清理未使用标签")])]},proxy:!0}])},[t("a-spin",{attrs:{spinning:e.list.loading}},[0===e.list.data.length?t("a-empty"):e._e(),e._l(e.list.data,(function(a){return t("post-tag",{key:a.id,staticStyle:{"margin-bottom":"8px",cursor:"pointer"},attrs:{tag:a},nativeOn:{click:function(t){return e.handleEdit(a)}}})}))],2)],1)],1)],1)],1)},r=[],l=a(70571),s=a(80068),i=a(65698),n=a(94927),d={components:{PageView:l.B4,Verte:n.Z},data(){return{list:{data:[],loading:!1},form:{model:{color:"#cfd3d7"},saving:!1,errored:!1,rules:{name:[{required:!0,message:"* 标签名称不能为空",trigger:["change"]},{max:255,message:"* 标签名称的字符长度不能超过 255",trigger:["change"]}],slug:[{max:255,message:"* 标签别名的字符长度不能超过 255",trigger:["change"]}],thumbnail:[{max:1023,message:"* 封面图链接的字符长度不能超过 1023",trigger:["change"]}],color:[{max:7,pattern:i.aX,message:"仅支持 hex 颜色值"}]}}}},computed:{title(){return this.isUpdateMode?"修改标签":"添加标签"},isUpdateMode(){return!!this.form.model.id}},created(){this.handleListTags()},methods:{handleEdit(e){this.form.model=e,this.$refs.tagForm.clearValidate()},handleListTags(){this.list.loading=!0,s.Z.tag.list({more:!0}).then((e=>{this.list.data=e.data})).finally((()=>{this.list.loading=!1}))},handleDeleteTag(e){s.Z.tag.delete(e).finally((()=>{this.form.model={color:"#cfd3d7"},this.handleListTags()}))},handleCreateOrUpdateTag(){const e=this;e.$refs.tagForm.validate((t=>{t&&(this.form.saving=!0,e.isUpdateMode?s.Z.tag.update(e.form.model.id,e.form.model).catch((()=>{this.form.errored=!0})).finally((()=>{setTimeout((()=>{e.form.saving=!1}),400)})):s.Z.tag.create(e.form.model).catch((()=>{this.form.errored=!0})).finally((()=>{setTimeout((()=>{e.form.saving=!1}),400)})))}))},handleSavedCallback(){const e=this;e.form.errored?e.form.errored=!1:(e.form.model={color:"#cfd3d7"},e.handleListTags())},handleCleanup(){const e=this.list.data.filter((e=>0===e.postCount));this.$confirm({title:"提示",content:"是否确认清理没有使用的标签？",okText:"确认",cancelText:"取消",onOk:async()=>{try{const t=e.map((e=>s.Z.tag.delete(e.id)));await Promise.all(t)}catch(t){this.$log.error("Failed to cleanup tags:",t)}finally{this.handleListTags()}}})}}},m=d,c=a(1001),f=(0,c.Z)(m,o,r,!1,null,null,null),u=f.exports}}]);
(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[942],{27942:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return q}});var s=function(){var e=this,t=e._self._c;return t("page-view",[t("ScrapListView",{ref:"scrapListView",attrs:{columns:e.scrapColumns},on:{"change:params":e.onChangeParams}})],1)},r=[],i=a(32422),n=function(){var e=this,t=e._self._c;return t("div",[t("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[t("div",[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:48}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"关键词："}},[t("a-input",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery()}},model:{value:e.list.params.key_word,callback:function(t){e.$set(e.list.params,"key_word",t)},expression:"list.params.key_word"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons"},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleQuery()}}},[e._v("查询")]),t("a-button",{on:{click:function(t){return e.handleResetParam()}}},[e._v("重置")])],1)],1)])],1)],1)],1),t("a-table",{attrs:{columns:e.columns,dataSource:e.list.data,pagination:!1},scopedSlots:e._u([{key:"action",fn:function(a,s){return[t("a-button",{on:{click:function(t){return e.handleEditClick(s)}}},[e._v(" 编辑 ")])]}}])}),t("div",{staticClass:"page-wrapper"},[t("a-pagination",{staticClass:"pagination",attrs:{current:e.pagination.page,defaultPageSize:e.pagination.size,pageSizeOptions:["5","10","20","50","100"],total:e.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:e.handlePageChange,showSizeChange:e.handlePageSizeChange}})],1)],1),t("ScrapEditModal",{attrs:{visible:e.pageEditVisible,page:e.list.selected,savedCallback:e.onPageSaveCallback},on:{"update:visible":function(t){e.pageEditVisible=t}}})],1)},l=[],o=(a(70560),a(6716)),c=a(55597),p=a(61446),d=a(70473),u=a(16879);const h=localStorage.getItem("apiUrl"),m=h||"",g=a(738),{HaloRestAPIClient:f}=a(55597);class b{constructor(e){this.client=e.buildHttpClient(),this._scrap=new g.ScrapClient(this.client)}get scrap(){return this._scrap}}const v=new f({baseUrl:m}),y=new b(v);v.interceptors.request.use((e=>{const t=o.Z.getters.token;return t&&t.access_token&&(e.headers["Admin-Authorization"]=t.access_token),e}),(e=>Promise.reject(e)));let k=!1,C=[];v.interceptors.response.use((e=>e),(async e=>{if(c.Axios.isCancel(e))return Promise.reject(e);if(/Network Error/.test(e.message))return p.Z.error("网络错误，请检查网络连接"),Promise.reject(e);const t=o.Z.getters.token,a=e.config,s=e.response,r=s?s.data:null;if(r){if(400===r.status){const t=r.data;if((0,u.Kn)(t)){const e=Object.keys(t||{}).map((e=>t[e]));d.Z.error({message:r.message,description:t=>{const a=e.map((e=>t("a-alert",{props:{message:e,banner:!0,showIcon:!1,type:"error"}})));return t("div",a)},duration:10})}else p.Z.error(r.message);return Promise.reject(e)}if(401===r.status){if(k)return new Promise((e=>{C.push((()=>{e((0,c.Axios)(a))}))}));k=!0;try{return await o.Z.dispatch("refreshToken",t.refresh_token),C.forEach((e=>e())),C=[],(0,c.Axios)(a)}catch(i){return p.Z.warning("当前登录状态已失效，请重新登录"),await o.Z.dispatch("ToggleLoginModal",!0),Promise.reject(i)}finally{k=!1}}return p.Z.error(r.message||"服务器错误"),Promise.reject(e)}return p.Z.error("网络异常"),Promise.reject(e)}));var w=y,S=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:680},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.modalTitle)+" ")]},proxy:!0},{key:"footer",fn:function(){return[e._t("extraFooter"),t("ReactiveButton",{attrs:{errored:e.form.saveError,loading:e.form.saving,text:"保存",erroredText:"保存失败",loadedText:"保存成功",type:"danger"},on:{callback:function(t){return e.handleSavedCallback()},click:function(t){return e.handleSavePage()}}}),t("a-button",{attrs:{disabled:e.loading},on:{click:function(t){e.modalVisible=!1}}},[e._v("关闭")])]},proxy:!0}],null,!0),model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("div",{staticClass:"card-container"},[t("a-form",{attrs:{labelAlign:"left","label-col":e.form.labelCol,"wrapper-col":e.form.wrapperCol}},[t("a-form-item",{attrs:{label:"文章标题"}},[t("a-input",{model:{value:e.form.model.title,callback:function(t){e.$set(e.form.model,"title",t)},expression:"form.model.title"}})],1)],1)],1)])},_=[],P={props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},page:{type:Object,default:()=>({})},savedCallback:{type:Function,default:null}},data(){return{form:{model:{},saving:!1,saveError:!1,labelCol:{sm:{span:4},xs:{span:24}},wrapperCol:{sm:{span:20},xs:{span:24}}}}},computed:{modalVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},modalTitle(){return"爬取信息修改"}},watch:{modalVisible(e){e&&(this.form.model=Object.assign({},this.page))},post:{deep:!0,handler(e){this.form.model=Object.assign({},e)}}},methods:{async handleSavePage(){try{this.form.saving=!0,await w.scrap.update(this.form.model.id,this.form.model)}catch(e){this.$log.error("Failed to save page",e)}finally{setTimeout((()=>{this.form.saving=!1}),400)}},handleSavedCallback(){this.form.saveError?this.form.saveError=!1:this.savedCallback&&this.savedCallback()}}},x=P,z=a(1001),E=(0,z.Z)(x,S,_,!1,null,null,null),V=E.exports,j={name:"ScrapListView",components:{ScrapEditModal:V},props:{columns:{type:Array,default:()=>[]}},computed:{pagination(){return{page:this.list.params.page,size:this.list.params.size,total:this.list.total}}},data(){return{list:{params:{page:1,size:10,key_word:""},total:0,hasPrevious:!1,hasNext:!1,loading:!1,data:[],selected:{}},pageEditVisible:!1,selectedRowKeys:[]}},watch:{"list.params":{deep:!0,handler:function(e){if(e){const e=JSON.parse(JSON.stringify(this.list.params));this.$emit("change:params",e)}}}},methods:{async handleScrapList(){try{const e=await w.scrap.list(this.list.params);this.list.data=e.data.content,this.list.hasNext=e.data.hasNext,this.list.hasPrevious=e.data.hasPrevious,this.list.total=e.data.total}catch(e){this.$log.error("Failed to change post status",e)}finally{this.list.loading=!1}},handleEditClick(e){this.list.selected=e,this.pageEditVisible=!0},onPageSaveCallback(){this.handleScrapList()},handlePageChange(e=1){this.list.params.page=e,this.handleScrapList()},handlePageSizeChange(e,t){this.$log.debug(`Current: ${e}, PageSize: ${t}`),this.list.params.page=1,this.list.params.size=t,this.handleScrapList()},handleQuery(){this.handlePageChange(1)},handleResetParam(){this.list.params.key_word=void 0,this.handlePageChange(1)}}},L=j,Z=(0,z.Z)(L,n,l,!1,null,"4385970c",null),$=Z.exports,O=a(70571),A={name:"ScrapList",components:{ScrapListView:$,PageView:O.B4},data(){return{scrapColumns:i.zQ}},beforeRouteEnter(e,t,a){a((t=>{const a=t.$refs.scrapListView;e.query.page&&(a.list.params.page=Number(e.query.page)),e.query.size&&(a.list.params.size=Number(e.query.size)),a.handleScrapList()}))},methods:{onChangeParams(e){const t=this.$router.history.current.path;this.$router.replace({path:t,query:e}).catch((e=>e))}}},N=A,T=(0,z.Z)(N,s,r,!1,null,"5bf2856e",null),q=T.exports},51873:function(e,t){class a{constructor(e){this.client=e}list(e){return this.client.get("/api/scrap_page",Object.assign({},e))}update(e,t){return this.client.post(`/api/admin/scrap_page/${e}`,Object.assign({},t))}}t._=a},738:function(e,t,a){"use strict";a.r(t),a.d(t,{ScrapClient:function(){return s._}});var s=a(51873)}}]);
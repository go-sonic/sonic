"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[44],{89044:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("page-view",[e("a-row",{attrs:{gutter:12,align:"middle",type:"flex"}},[e("a-col",{staticClass:"pb-3",attrs:{span:24}},[e("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:48}},[e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"关键词："}},[e("a-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery()}},model:{value:t.list.params.keyword,callback:function(e){t.$set(t.list.params,"keyword",e)},expression:"list.params.keyword"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"存储位置："}},[e("a-select",{attrs:{loading:t.types.loading,allowClear:""},on:{change:function(e){return t.handleQuery()}},model:{value:t.list.params.attachmentType,callback:function(e){t.$set(t.list.params,"attachmentType",e)},expression:"list.params.attachmentType"}},t._l(t.types.data,(function(a){return e("a-select-option",{key:a,attrs:{value:a}},[t._v(" "+t._s(t._f("typeText")(a))+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"文件类型："}},[e("a-select",{attrs:{loading:t.mediaTypes.loading,allowClear:""},on:{change:function(e){return t.handleQuery()}},model:{value:t.list.params.mediaType,callback:function(e){t.$set(t.list.params,"mediaType",e)},expression:"list.params.mediaType"}},t._l(t.mediaTypes.data,(function(a,s){return e("a-select-option",{key:s,attrs:{value:a}},[t._v(t._s(a)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons"},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleQuery()}}},[t._v("查询")]),e("a-button",{on:{click:function(e){return t.handleResetParam()}}},[t._v("重置")])],1)],1)])],1)],1)],1),e("div",{staticClass:"table-operator mb-0"},[e("a-button",{attrs:{icon:"cloud-upload",type:"primary"},on:{click:function(e){t.upload.visible=!0}}},[t._v("上传")]),e("a-button",{directives:[{name:"show",rawName:"v-show",value:t.list.selected.length,expression:"list.selected.length"}],attrs:{icon:"check-circle",type:"primary"},on:{click:t.handleSelectAll}},[t._v(" 全选 ")]),e("a-button",{directives:[{name:"show",rawName:"v-show",value:t.list.selected.length,expression:"list.selected.length"}],attrs:{icon:"delete",type:"danger"},on:{click:t.handleDeleteAttachmentInBatch}},[t._v(" 删除 ")]),e("a-button",{directives:[{name:"show",rawName:"v-show",value:t.list.selected.length,expression:"list.selected.length"}],attrs:{icon:"close"},on:{click:function(e){t.list.selected=[]}}},[t._v(" 取消")])],1)])],1),e("a-col",{attrs:{span:24}},[e("a-spin",{attrs:{spinning:t.list.loading}},[e("div",{staticClass:"grid grid-cols-2 gap-x-2 gap-y-3 sm:grid-cols-3 md:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-10",attrs:{role:"list"}},t._l(t.list.data,(function(a,s){return e("div",{key:s,staticClass:"relative cursor-pointer overflow-hidden rounded-sm border-solid bg-white transition-all hover:shadow-sm",class:""+(t.isItemSelect(a)?"border-blue-600":"border-white"),on:{click:function(e){return t.handleItemClick(a)},mouseenter:function(e){return t.$set(a,"hover",!0)},mouseleave:function(e){return t.$set(a,"hover",!1)},contextmenu:function(e){return e.preventDefault(),t.handleContextMenu(e,a)}}},[e("div",{staticClass:"group aspect-w-10 aspect-h-7 block w-full overflow-hidden bg-white"},[t.isImage(a)?e("img",{staticClass:"pointer-events-none overflow-hidden object-cover transition-opacity group-hover:opacity-70",attrs:{alt:a.name,src:a.thumbPath,loading:"lazy"}}):e("span",{staticClass:"flex items-center justify-center text-2xl text-gray-600"},[t._v(" "+t._s(a.suffix)+" ")])]),e("a-tooltip",{attrs:{title:a.name}},[e("span",{staticClass:"block truncate p-1.5 text-xs font-medium text-gray-500"},[t._v(" "+t._s(a.name)+" ")])]),e("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isItemSelect(a)&&a.hover,expression:"!isItemSelect(attachment) && attachment.hover"}],staticClass:"absolute top-1 right-1 cursor-pointer font-bold transition-all",style:{fontSize:"20px",color:"rgb(37 99 235)"},attrs:{theme:"twoTone",type:"plus-circle"},on:{click:function(e){return e.stopPropagation(),t.handleSelect(a)}}}),e("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.isItemSelect(a),expression:"isItemSelect(attachment)"}],staticClass:"absolute top-1 right-1 cursor-pointer font-bold transition-all",style:{fontSize:"20px",color:"rgb(37 99 235)"},attrs:{theme:"twoTone",type:"check-circle"}}),e("a-icon",{directives:[{name:"show",rawName:"v-show",value:a.hover&&t.list.selected.length>0,expression:"attachment.hover && list.selected.length > 0"}],staticClass:"absolute top-1 left-1 cursor-pointer font-bold transition-all",style:{fontSize:"20px"},attrs:{theme:"twoTone",type:"profile"},on:{click:function(e){return e.stopPropagation(),t.handleOpenDetail(a)}}})],1)})),0)])],1)],1),e("div",{staticClass:"page-wrapper"},[e("a-pagination",{staticClass:"pagination",attrs:{current:t.pagination.page,defaultPageSize:t.pagination.size,pageSizeOptions:["50","100","150","200"],total:t.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:t.handlePageChange,showSizeChange:t.handlePageSizeChange}})],1),e("AttachmentUploadModal",{attrs:{visible:t.upload.visible},on:{"update:visible":function(e){return t.$set(t.upload,"visible",e)},close:t.onUploadClose}}),e("AttachmentDetailModal",{attrs:{addToPhoto:!0,attachment:t.list.current,visible:t.detailVisible},on:{"update:visible":function(e){t.detailVisible=e},delete:function(e){return t.handleListAttachments()}},scopedSlots:t._u([{key:"extraFooter",fn:function(){return[e("a-button",{attrs:{disabled:t.selectPreviousButtonDisabled},on:{click:t.handleSelectPrevious}},[t._v("上一项")]),e("a-button",{attrs:{disabled:t.selectNextButtonDisabled},on:{click:t.handleSelectNext}},[t._v("下一项")])]},proxy:!0}])})],1)},i=[],l=a(83428),n=a(70571),o=a(80068),r=a(32422),c={components:{PageView:n.B4},mixins:[l.jB,l.KT],filters:{typeText(t){return r.k[t].text}},data(){return{list:{data:[],loading:!1,total:0,hasNext:!1,hasPrevious:!1,params:{page:0,size:50,keyword:void 0,mediaType:void 0,attachmentType:void 0},selected:[],current:{}},mediaTypes:{data:[],loading:!1},types:{data:[],loading:!1},upload:{visible:!1},detailVisible:!1}},computed:{isImage(){return function(t){return!(!t||!t.mediaType)&&t.mediaType.startsWith("image")}},isItemSelect(){return function(t){return this.list.selected.findIndex((e=>e.id===t.id))>-1}},pagination(){return{page:this.list.params.page+1,size:this.list.params.size,total:this.list.total}},selectPreviousButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));return 0===t&&!this.list.hasPrevious},selectNextButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));return t===this.list.data.length-1&&!this.list.hasNext}},created(){this.handleListAttachments(),this.handleListMediaTypes(),this.handleListTypes()},methods:{async handleListAttachments(){try{this.list.loading=!0;const t=await o.Z.attachment.list(this.list.params);if(0===t.data.content.length&&this.list.params.page>0)return this.list.params.page--,void await this.handleListAttachments();this.list.data=t.data.content,this.list.total=t.data.total,this.list.hasNext=t.data.hasNext,this.list.hasPrevious=t.data.hasPrevious}catch(t){this.$log.error(t)}finally{this.list.loading=!1}},async handleListMediaTypes(){try{this.mediaTypes.loading=!0;const t=await o.Z.attachment.listMediaTypes();this.mediaTypes.data=t.data}catch(t){this.$log.error(t)}finally{this.mediaTypes.loading=!1}},async handleListTypes(){try{this.types.loading=!0;const t=await o.Z.attachment.listTypes();this.types.data=t.data}catch(t){this.$log.error(t)}finally{this.types.loading=!1}},handleOpenDetail(t){this.list.current=t,this.detailVisible=!0},handleItemClick(t){this.list.selected.length<=0?this.handleOpenDetail(t):this.isItemSelect(t)?this.handleUnselect(t):this.handleSelect(t)},handleSelect(t){this.list.selected=[...this.list.selected,t]},handleUnselect(t){this.list.selected=this.list.selected.filter((e=>e.id!==t.id))},handleSelectAll(){this.list.selected=this.list.data},handleContextMenu(t,e){return this.$contextmenu({items:[{label:`复制${this.isImage(e)?"图片":"文件"}链接`,onClick:()=>{const t=`${encodeURI(e.path)}`;this.$copyText(t).then((t=>{this.$log.debug("copy",t),this.$message.success("复制成功！")})).catch((t=>{this.$log.debug("copy.err",t),this.$message.error("复制失败！")}))},divided:!0},{disabled:!this.isImage(e),label:"复制 Markdown 格式链接",onClick:()=>{const t=`![${e.name}](${encodeURI(e.path)})`;this.$copyText(t).then((t=>{this.$log.debug("copy",t),this.$message.success("复制成功！")})).catch((t=>{this.$log.debug("copy.err",t),this.$message.error("复制失败！")}))},divided:!0},{label:"删除",onClick:()=>{this.$confirm({title:"提示",content:"确定删除该附件？",okText:"确定",cancelText:"取消",onOk:async()=>{await o.Z.attachment.delete(e.id),await this.handleListAttachments(),this.handleUnselect(e)}})}}],event:t,minWidth:210}),!1},handlePageChange(t=1){this.list.params.page=t-1,this.handleListAttachments()},handlePageSizeChange(t,e){this.$log.debug(`Current: ${t}, PageSize: ${e}`),this.list.params.page=0,this.list.params.size=e,this.handleListAttachments()},handleResetParam(){this.list.params.keyword=void 0,this.list.params.mediaType=void 0,this.list.params.attachmentType=void 0,this.handlePageChange(),this.handleListMediaTypes(),this.handleListTypes()},handleQuery(){this.handlePageChange()},onUploadClose(){this.handlePageChange(),this.handleListMediaTypes(),this.handleListTypes()},handleDeleteAttachmentInBatch(){const t=this;this.list.selected.length<=0?this.$message.warn("你还未选择任何附件，请至少选择一个！"):this.$confirm({title:"确定要批量删除选中的附件吗？",content:"一旦删除不可恢复，请谨慎操作",async onOk(){try{const e=t.list.selected.map((t=>t.id));await o.Z.attachment.deleteInBatch(e),t.list.selected=[],t.$message.success("删除成功")}catch(e){t.$log.error("Failed to delete selected attachments",e)}finally{await t.handleListAttachments()}}})},async handleSelectPrevious(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));t>0?this.list.current=this.list.data[t-1]:0===t&&this.list.hasPrevious&&(this.list.params.page--,await this.handleListAttachments(),this.list.current=this.list.data[this.list.data.length-1])},async handleSelectNext(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));t<this.list.data.length-1?this.list.current=this.list.data[t+1]:t===this.list.data.length-1&&this.list.hasNext&&(this.list.params.page++,await this.handleListAttachments(),this.list.current=this.list.data[0])}}},h=c,d=a(1001),p=(0,d.Z)(h,s,i,!1,null,null,null),u=p.exports}}]);
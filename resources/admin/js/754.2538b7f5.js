"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[754],{51823:function(t,e,a){a.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{destroyOnClose:"",title:"评论回复"},on:{close:t.onClose},scopedSlots:t._u([{key:"footer",fn:function(){return[e("ReactiveButton",{attrs:{errored:t.submitErrored,loading:t.submitting,erroredText:"回复失败",loadedText:"回复成功",text:"回复",type:"primary"},on:{callback:t.handleSubmitCallback,click:t.handleSubmit}})]},proxy:!0}]),model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[e("a-form-model",{ref:"replyCommentForm",attrs:{model:t.model,rules:t.rules,layout:"vertical"}},[e("a-form-model-item",{attrs:{prop:"content"}},[e("a-input",{ref:"contentInput",attrs:{autoSize:{minRows:8},type:"textarea"},model:{value:t.model.content,callback:function(e){t.$set(t.model,"content",e)},expression:"model.content"}})],1)],1)],1)},i=[],n=a(80068),l={name:"CommentReplyModal",props:{visible:{type:Boolean,default:!0},comment:{type:Object,default:null},targetId:{type:Number,default:0},target:{type:String,required:!0,validator:t=>-1!==["post","sheet","journal"].indexOf(t)}},data(){return{model:{},submitting:!1,submitErrored:!1,rules:{content:[{required:!0,message:"* 内容不能为空",trigger:["change"]}]}}},computed:{modalVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}}},watch:{modalVisible(t){t&&this.$nextTick((()=>{this.$refs.contentInput.focus()}))}},methods:{handleSubmit(){const t=this;t.$refs.replyCommentForm.validate((async e=>{if(e)try{t.submitting=!0,t.model.postId=t.targetId,t.comment&&(t.model.parentId=t.comment.id),await n.Z.comment.create(`${t.target}s`,t.model)}catch(a){t.submitErrored=!0}finally{setTimeout((()=>{t.submitting=!1}),400)}}))},handleSubmitCallback(){this.submitErrored?this.submitErrored=!1:(this.model={},this.modalVisible=!1,this.$emit("succeed"))},onClose(){this.model={},this.modalVisible=!1}}},o=l,r=a(1001),d=(0,r.Z)(o,s,i,!1,null,null,null),c=d.exports},33196:function(t,e,a){a.d(e,{Z:function(){return b}});var s=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{afterClose:t.onClose,title:t.title,width:1024,destroyOnClose:""},scopedSlots:t._u([{key:"footer",fn:function(){return[t._t("extraFooter"),e("a-button",{attrs:{type:"primary"},on:{click:function(e){t.replyModalVisible=!0}}},[t._v("创建评论")]),e("a-button",{on:{click:function(e){t.modalVisible=!1}}},[t._v("关闭")])]},proxy:!0}],null,!0),model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[e("a-list",{attrs:{loading:t.list.loading,"item-layout":"vertical"}},t._l(t.list.data,(function(a,s){return e("TargetCommentTreeNode",{key:s,attrs:{comment:a,target:t.target,"target-id":t.targetId},on:{reload:t.handleGetComments}})})),1),e("div",{staticClass:"page-wrapper"},[e("a-pagination",{staticClass:"pagination",attrs:{current:t.pagination.page,defaultPageSize:t.pagination.size,pageSizeOptions:["10","20","50","100"],total:t.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:t.handlePageChange,showSizeChange:t.handlePageSizeChange}})],1),e("CommentReplyModal",{attrs:{target:t.target,"target-id":t.targetId,visible:t.replyModalVisible},on:{"update:visible":function(e){t.replyModalVisible=e},succeed:t.handleGetComments}})],1)},i=[],n=function(){var t=this,e=t._self._c;return e("a-list-item",{staticClass:"!p-0"},[e("a-comment",{scopedSlots:t._u([{key:"author",fn:function(){return[e("a",{attrs:{href:t.comment.authorUrl,target:"_blank"}},[t.comment.isAdmin?e("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"user"}}):t._e(),t._v(" "+t._s(t.comment.author)+" ")],1)]},proxy:!0},{key:"avatar",fn:function(){return[e("a-avatar",{attrs:{alt:t.comment.author,src:t.comment.avatar,size:"large"}})]},proxy:!0},{key:"content",fn:function(){return[e("div",{staticClass:"comment-modal-content",domProps:{innerHTML:t._s(t.$options.filters.markdownRender(t.comment.content))}})]},proxy:!0},{key:"datetime",fn:function(){return[e("a-tooltip",{scopedSlots:t._u([{key:"title",fn:function(){return[e("span",[t._v(t._s(t._f("moment")(t.comment.createTime)))])]},proxy:!0}])},[e("span",[t._v(t._s(t._f("timeAgo")(t.comment.createTime)))])])]},proxy:!0},{key:"actions",fn:function(){return["AUDITING"===t.comment.status?e("a-dropdown",{attrs:{trigger:["click"]},scopedSlots:t._u([{key:"overlay",fn:function(){return[e("a-menu",[e("a-menu-item",{key:"1",on:{click:function(e){return t.handleChangeStatus("PUBLISHED")}}},[t._v(" 通过")]),e("a-menu-item",{key:"2",on:{click:t.handlePublishAndReply}},[t._v(" 通过并回复")])],1)]},proxy:!0}],null,!1,357119804)},[e("span",[t._v("通过")])]):"PUBLISHED"===t.comment.status?e("span",{on:{click:function(e){t.replyModalVisible=!0}}},[t._v("回复")]):"RECYCLE"===t.comment.status?e("a-popconfirm",{attrs:{title:"你确定要还原该评论？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleChangeStatus("PUBLISHED")}}},[t._v(" 还原 ")]):t._e(),"PUBLISHED"===t.comment.status||"AUDITING"===t.comment.status?e("a-popconfirm",{attrs:{title:"你确定要将该评论移到回收站？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleChangeStatus("RECYCLE")}}},[t._v(" 回收站 ")]):t._e(),e("a-popconfirm",{attrs:{title:"你确定要永久删除该评论？",cancelText:"取消",okText:"确定"},on:{confirm:t.handleDelete}},[t._v(" 删除 ")])]},proxy:!0}])},[t.comment.children?t._l(t.comment.children,(function(a,s){return e("TargetCommentTreeNode",{key:s,attrs:{comment:a,target:t.target,"target-id":t.targetId},on:{reload:function(e){return t.$emit("reload")}}})})):t._e(),e("CommentReplyModal",{attrs:{comment:t.comment,target:t.target,"target-id":t.targetId,visible:t.replyModalVisible},on:{"update:visible":function(e){t.replyModalVisible=e},succeed:function(e){return t.$emit("reload")}}})],2)],1)},l=[],o=a(80068),r=a(51823),d={name:"TargetCommentTreeNode",components:{CommentReplyModal:r.Z},props:{target:{type:String,required:!0,validator:t=>-1!==["post","sheet","journal"].indexOf(t)},targetId:{type:Number,required:!0,default:0},comment:{type:Object,required:!1,default:null}},data(){return{replyModalVisible:!1}},methods:{async handleChangeStatus(t){try{await o.Z.comment.updateStatusById(`${this.target}s`,this.comment.id,t)}catch(e){this.$log.error("Failed to change comment status",e)}finally{this.$emit("reload")}},async handlePublishAndReply(){await this.handleChangeStatus("PUBLISHED"),this.replyModalVisible=!0},async handleDelete(){try{await o.Z.comment.delete(`${this.target}s`,this.comment.id)}catch(t){this.$log.error("Failed to delete comment",t)}finally{this.$emit("reload")}}}},c=d,m=a(1001),u=(0,m.Z)(c,n,l,!1,null,null,null),h=u.exports,p={name:"TargetCommentListModal",components:{TargetCommentTreeNode:h,CommentReplyModal:r.Z},props:{visible:{type:Boolean,default:!0},title:{type:String,default:"评论"},target:{type:String,required:!0,validator:t=>-1!==["post","sheet","journal"].indexOf(t)},targetId:{type:Number,required:!0,default:0}},data(){return{list:{data:[],loading:!1,params:{page:0,size:10},total:0},replyModalVisible:!1}},computed:{modalVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}},pagination(){return{page:this.list.params.page+1,size:this.list.params.size,total:this.list.total}}},watch:{modalVisible(t){t&&this.handleGetComments()},targetId(){this.handleGetComments()}},methods:{async handleGetComments(){try{this.list.loading=!0;const t=await o.Z.comment.listAsTreeView(`${this.target}s`,this.targetId,this.list.params);this.list.data=t.data.content,this.list.total=t.data.total}catch(t){this.$log.error("Failed to get target comments",t)}finally{this.list.loading=!1}},handlePageChange(t=1){this.list.params.page=t-1,this.handleGetComments()},handlePageSizeChange(t,e){this.list.params.page=0,this.list.params.size=e,this.handleGetComments()},onClose(){this.$emit("close")}}},f=p,g=(0,m.Z)(f,s,i,!1,null,null,null),b=g.exports},18754:function(t,e,a){a.r(e),a.d(e,{default:function(){return E}});var s=function(){var t=this,e=t._self._c;return e("page-view",[e("a-row",[e("a-col",{attrs:{span:24}},[e("div",{staticClass:"card-container"},[e("a-tabs",{attrs:{type:"card"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},t._l(t.panes,(function(a){return e("a-tab-pane",{key:a.key},[e("span",{attrs:{slot:"tab"},slot:"tab"},[e("a-icon",{attrs:{type:a.icon}}),t._v(t._s(a.title)+" ")],1),e(a.component,{tag:"component"})],1)})),1)],1)])],1)],1)},i=[],n=(a(70560),a(70571)),l=function(){var t=this,e=t._self._c;return e("div",[t.isMobile()?e("a-list",{attrs:{dataSource:t.independentSheets,loading:t.loading,pagination:!1,itemLayout:"vertical",size:"large"},scopedSlots:t._u([{key:"renderItem",fn:function(a,s){return e("a-list-item",{key:s},[e("template",{slot:"actions"},[e("span",[e("router-link",{attrs:{to:{name:a.routeName}}},[e("a-icon",{attrs:{type:"edit"}})],1)],1)]),e("template",{slot:"extra"},[a.available?e("span",[t._v("可用")]):e("span",[t._v("不可用 "),e("a-tooltip",{attrs:{slot:"action",title:"当前主题没有对应模板"},slot:"action"},[e("a-icon",{attrs:{type:"info-circle-o"}})],1)],1)]),e("a-list-item-meta",[e("span",{staticStyle:{"max-width":"300px",display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},attrs:{slot:"title"},slot:"title"},[a.available?e("a",{attrs:{href:a.fullPath,target:"_blank"}},[t._v(t._s(a.title))]):e("a",{attrs:{href:a.fullPath,disabled:"",target:"_blank"}},[t._v(t._s(a.title))])])])],2)}}],null,!1,490164655)}):e("a-table",{attrs:{columns:t.independentColumns,dataSource:t.independentSheets,loading:t.loading,pagination:!1,rowKey:t=>t.id},scopedSlots:t._u([{key:"available",fn:function(a){return[a?e("span",[t._v("可用")]):e("span",[t._v(" 不可用 "),e("a-tooltip",{attrs:{slot:"action",title:"当前主题没有对应模板"},slot:"action"},[e("a-icon",{attrs:{type:"info-circle-o"}})],1)],1)]}},{key:"action",fn:function(a,s){return e("span",{},[e("router-link",{attrs:{to:{name:s.routeName}}},[e("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("管理")])],1),e("a-divider",{attrs:{type:"vertical"}}),s.available?e("a",{attrs:{href:s.fullPath,target:"_blank"}},[t._v("访问")]):e("a",{attrs:{href:s.fullPath,disabled:"",target:"_blank"}},[t._v("访问")])],1)}}])})],1)},o=[],r=a(83428),d=a(80068);const c=[{title:"页面名称",dataIndex:"title"},{title:"访问地址",dataIndex:"fullPath"},{title:"状态",dataIndex:"available",scopedSlots:{customRender:"available"}},{title:"操作",dataIndex:"action",width:"150px",scopedSlots:{customRender:"action"}}];var m={name:"IndependentSheetList",mixins:[r.jB,r.KT],data(){return{independentColumns:c,independentSheets:[],loading:!1}},created(){this.handleListIndependentSheets()},methods:{async handleListIndependentSheets(){try{const{data:t}=await d.Z.sheet.listIndependents();this.independentSheets=t}catch(t){this.$log.error(t)}finally{this.loading=!1}}}},u=m,h=a(1001),p=(0,h.Z)(u,l,o,!1,null,null,null),f=p.exports,g=function(){var t=this,e=t._self._c;return e("div",[t.isMobile()?e("a-list",{attrs:{dataSource:t.list.data,loading:t.list.loading,pagination:!1,itemLayout:"vertical",size:"large"},scopedSlots:t._u([{key:"renderItem",fn:function(a,s){return[e("a-list-item",{key:s,scopedSlots:t._u([{key:"actions",fn:function(){return[e("span",[e("a-icon",{attrs:{type:"eye"}}),t._v(" "+t._s(a.visits)+" ")],1),e("span",{on:{click:function(e){return t.handleOpenSheetComments(a)}}},[e("a-icon",{attrs:{type:"message"}}),t._v(" "+t._s(a.commentCount)+" ")],1),e("a-dropdown",{attrs:{trigger:["click"],placement:"topLeft"},scopedSlots:t._u([{key:"overlay",fn:function(){return[e("a-menu",["PUBLISHED"===a.status||"DRAFT"===a.status?e("a-menu-item",{on:{click:function(e){return t.handleEditClick(a)}}},[t._v(" 编辑 ")]):"RECYCLE"===a.status?e("a-menu-item",[e("a-popconfirm",{attrs:{title:"你确定要发布【"+a.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleChangeStatus(a.id,"PUBLISHED")}}},[t._v(" 还原 ")])],1):t._e(),"PUBLISHED"===a.status||"DRAFT"===a.status?e("a-menu-item",[e("a-popconfirm",{attrs:{title:"你确定要删除【"+a.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleChangeStatus(a.id,"RECYCLE")}}},[t._v(" 删除 ")])],1):"RECYCLE"===a.status?e("a-menu-item",[e("a-popconfirm",{attrs:{title:"你确定要永久删除【"+a.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleDelete(a.id)}}},[t._v(" 永久删除 ")])],1):t._e(),e("a-menu-item",{on:{click:function(e){return t.handleOpenSheetSettings(a)}}},[t._v("设置")])],1)]},proxy:!0}],null,!0)},[e("span",[e("a-icon",{attrs:{type:"bars"}})],1)])]},proxy:!0},{key:"extra",fn:function(){return[e("a-badge",{attrs:{status:t.sheetStatuses[a.status].status,text:t._f("statusText")(a.status)}})]},proxy:!0}],null,!0)},[e("a-list-item-meta",{scopedSlots:t._u([{key:"description",fn:function(){return[t._v(" "+t._s(t._f("moment")(a.createTime))+" ")]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticStyle:{"max-width":"300px",display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[a.inProgress?e("a-tooltip",{attrs:{placement:"top",title:"当前有内容已保存，但还未发布。"}},[e("a-icon",{staticClass:"cursor-pointer",staticStyle:{"margin-right":"3px"},attrs:{theme:"twoTone",twoToneColor:"#52c41a",type:"info-circle"},on:{click:function(e){return t.handleEditClick(a)}}})],1):t._e(),"PUBLISHED"===a.status?e("a-tooltip",{attrs:{title:"点击访问【"+a.title+"】",placement:"top"}},[e("a",{staticClass:"no-underline",attrs:{href:a.fullPath,target:"_blank"}},[t._v(" "+t._s(a.title)+" ")])]):"DRAFT"===a.status?e("a-tooltip",{attrs:{title:"点击预览【"+a.title+"】",placement:"top"}},[e("a",{staticClass:"no-underline",attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.handlePreview(a.id)}}},[t._v(" "+t._s(a.title)+" ")])]):e("a",{staticClass:"no-underline",attrs:{href:"javascript:void(0);",disabled:""}},[t._v(" "+t._s(a.title)+" ")])],1)]},proxy:!0}],null,!0)}),a.summary?e("div",{staticClass:"block"},[e("span",[t._v(" "+t._s(a.summary)+"... ")])]):t._e()],1)]}}],null,!1,1626759435)}):e("a-table",{attrs:{columns:t.customColumns,dataSource:t.list.data,loading:t.list.loading,pagination:!1,rowKey:t=>t.id,scrollToFirstRowOnChange:!0},scopedSlots:t._u([{key:"sheetTitle",fn:function(a,s){return[s.inProgress?e("a-tooltip",{attrs:{placement:"top",title:"当前有内容已保存，但还未发布。"}},[e("a-icon",{staticClass:"cursor-pointer",staticStyle:{"margin-right":"3px"},attrs:{theme:"twoTone",twoToneColor:"#52c41a",type:"info-circle"},on:{click:function(e){return t.handleEditClick(s)}}})],1):t._e(),"PUBLISHED"===s.status?e("a-tooltip",{attrs:{title:"点击访问【"+a+"】",placement:"top"}},[e("a",{staticClass:"no-underline",attrs:{href:s.fullPath,target:"_blank"}},[t._v(" "+t._s(a)+" ")])]):"DRAFT"===s.status?e("a-tooltip",{attrs:{title:"点击预览【"+a+"】",placement:"top"}},[e("a",{staticClass:"no-underline",attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.handlePreview(s.id)}}},[t._v(" "+t._s(a)+" ")])]):e("a",{staticClass:"no-underline",attrs:{href:"javascript:void(0);",disabled:""}},[t._v(" "+t._s(a)+" ")])]}},{key:"status",fn:function(a){return[e("a-badge",{attrs:{status:t.sheetStatuses[a].status,text:t._f("statusText")(a)}})]}},{key:"commentCount",fn:function(a,s){return[e("a-badge",{staticClass:"cursor-pointer",attrs:{count:s.commentCount,numberStyle:{backgroundColor:"#f38181"},overflowCount:999,showZero:!0},on:{click:function(e){return t.handleOpenSheetComments(s)}}})]}},{key:"visits",fn:function(t){return[e("a-badge",{attrs:{count:t,numberStyle:{backgroundColor:"#00e0ff"},overflowCount:9999,showZero:!0}})]}},{key:"createTime",fn:function(a){return[e("a-tooltip",{attrs:{placement:"top"},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" "+t._s(t._f("moment")(a))+" ")]},proxy:!0}],null,!0)},[t._v(" "+t._s(t._f("timeAgo")(a))+" ")])]}},{key:"action",fn:function(a,s){return["PUBLISHED"===s.status||"DRAFT"===s.status?e("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(e){return t.handleEditClick(s)}}},[t._v(" 编辑 ")]):"RECYCLE"===s.status?e("a-popconfirm",{attrs:{title:"你确定要发布【"+s.title+"】？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleChangeStatus(s.id,"PUBLISHED")}}},[e("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("还原")])],1):t._e(),e("a-divider",{attrs:{type:"vertical"}}),"PUBLISHED"===s.status||"DRAFT"===s.status?e("a-popconfirm",{attrs:{title:"你确定要删除【"+s.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleChangeStatus(s.id,"RECYCLE")}}},[e("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("删除")])],1):"RECYCLE"===s.status?e("a-popconfirm",{attrs:{title:"你确定要永久删除【"+s.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleDelete(s.id)}}},[e("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("永久删除")])],1):t._e(),e("a-divider",{attrs:{type:"vertical"}}),e("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(e){return t.handleOpenSheetSettings(s)}}},[t._v("设置")])]}}])}),e("div",{staticClass:"page-wrapper"},[e("a-pagination",{staticClass:"pagination",attrs:{current:t.pagination.page,defaultPageSize:t.pagination.size,pageSizeOptions:["10","20","50","100"],total:t.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:t.handlePageChange,showSizeChange:t.handlePageSizeChange}})],1),e("SheetSettingModal",{attrs:{loading:t.sheetSettingLoading,savedCallback:t.onSheetSavedCallback,sheet:t.list.selected,visible:t.sheetSettingVisible},on:{"update:visible":function(e){t.sheetSettingVisible=e},onClose:function(e){t.list.selected={}}},scopedSlots:t._u([{key:"extraFooter",fn:function(){return[e("a-button",{attrs:{disabled:t.selectPreviousButtonDisabled},on:{click:t.handleSelectPrevious}},[t._v(" 上一篇")]),e("a-button",{attrs:{disabled:t.selectNextButtonDisabled},on:{click:t.handleSelectNext}},[t._v(" 下一篇")])]},proxy:!0}])}),e("TargetCommentListModal",{attrs:{"target-id":t.list.selected.id,title:`「${t.list.selected.title}」的评论`,visible:t.sheetCommentVisible,target:"sheet"},on:{"update:visible":function(e){t.sheetCommentVisible=e},close:t.onSheetCommentsClose},scopedSlots:t._u([{key:"extraFooter",fn:function(){return[e("a-button",{attrs:{disabled:t.selectPreviousButtonDisabled},on:{click:t.handleSelectPrevious}},[t._v(" 上一篇")]),e("a-button",{attrs:{disabled:t.selectNextButtonDisabled},on:{click:t.handleSelectNext}},[t._v(" 下一篇")])]},proxy:!0}])})],1)},b=[],v=a(52173),y=a(33196),S=a(32422);const C=[{title:"标题",dataIndex:"title",ellipsis:!0,scopedSlots:{customRender:"sheetTitle"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"评论量",dataIndex:"commentCount",scopedSlots:{customRender:"commentCount"}},{title:"访问量",dataIndex:"visits",scopedSlots:{customRender:"visits"}},{title:"发布时间",dataIndex:"createTime",scopedSlots:{customRender:"createTime"}},{title:"操作",width:"200px",scopedSlots:{customRender:"action"}}];var k={name:"CustomSheetList",mixins:[r.jB,r.KT],components:{SheetSettingModal:v.Z,TargetCommentListModal:y.Z},data(){return{customColumns:C,sheetStatuses:S.Zi,list:{data:[],loading:!1,total:0,hasPrevious:!1,hasNext:!1,params:{page:0,size:10},selected:{}},sheetSettingVisible:!1,sheetSettingLoading:!1,sheetCommentVisible:!1}},computed:{pagination(){return{page:this.list.params.page+1,size:this.list.params.size,total:this.list.total}},selectPreviousButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.list.selected.id));return 0===t&&!this.list.hasPrevious},selectNextButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.list.selected.id));return t===this.list.data.length-1&&!this.list.hasNext}},created(){this.handleListSheets()},methods:{async handleListSheets(t=!0){try{t&&(this.list.loading=!0);const{data:e}=await d.Z.sheet.list(this.list.params);if(0===e.content.length&&this.list.params.page>0)return this.list.params.page--,void await this.handleListSheets();this.list.data=e.content,this.list.total=e.total,this.list.hasPrevious=e.hasPrevious,this.list.hasNext=e.hasNext}catch(e){this.$log.error(e)}finally{this.list.loading=!1}},handleEditClick(t){this.$router.push({name:"SheetEdit",query:{sheetId:t.id}})},async handleChangeStatus(t,e){try{await d.Z.sheet.updateStatusById(t,e),this.$message.success("操作成功！")}catch(a){this.$log.error("Failed to change sheet status",a)}finally{await this.handleListSheets()}},async handleDelete(t){try{await d.Z.sheet.delete(t),this.$message.success("删除成功！")}catch(e){this.$log.error("Failed to delete sheet",e)}finally{await this.handleListSheets()}},async handleOpenSheetSettings(t){try{this.sheetSettingVisible=!0,this.sheetSettingLoading=!0;const{data:e}=await d.Z.sheet.get(t.id);this.list.selected=e}catch(e){this.$log.error("Failed to open sheet settings",e)}finally{this.sheetSettingLoading=!1}},handleOpenSheetComments(t){this.list.selected=t,this.sheetCommentVisible=!0},handlePreview(t){d.Z.sheet.getPreviewLinkById(t).then((t=>{window.open(t,"_blank")}))},handlePageChange(t=1){this.list.params.page=t-1,this.handleListSheets()},handlePageSizeChange(t,e){this.$log.debug(`Current: ${t}, PageSize: ${e}`),this.list.params.page=0,this.list.params.size=e,this.handleListSheets()},onSheetCommentsClose(){this.sheetCommentVisible=!1,this.list.selected={},this.handleListSheets(!1)},onSheetSavedCallback(){this.handleListSheets(!1)},async handleSelectPrevious(){const t=this.list.data.findIndex((t=>t.id===this.list.selected.id));if(t>0){this.sheetSettingLoading=!0;const e=await d.Z.sheet.get(this.list.data[t-1].id);return this.list.selected=e.data,void(this.sheetSettingLoading=!1)}if(0===t&&this.list.hasPrevious){this.list.params.page--,await this.handleListPosts(),this.sheetSettingLoading=!0;const t=await d.Z.sheet.get(this.list.data[this.list.data.length-1].id);this.list.selected=t.data,this.sheetSettingLoading=!1}},async handleSelectNext(){const t=this.list.data.findIndex((t=>t.id===this.list.selected.id));if(t<this.list.data.length-1){this.sheetSettingLoading=!0;const e=await d.Z.sheet.get(this.list.data[t+1].id);return this.list.selected=e.data,void(this.sheetSettingLoading=!1)}if(t===this.list.data.length-1&&this.list.hasNext){this.list.params.page++,await this.handleListPosts(),this.sheetSettingLoading=!0;const t=await d.Z.sheet.get(this.list.data[0].id);this.list.selected=t.data,this.sheetSettingLoading=!1}}},filters:{statusText(t){return t?S.Zi[t].text:""}}},_=k,x=(0,h.Z)(_,g,b,!1,null,null,null),w=x.exports,T={components:{PageView:n.B4,IndependentSheetList:f,CustomSheetList:w},data(){const t=[{title:"独立页面",icon:"paper-clip",component:"IndependentSheetList",key:"independent"},{title:"自定义页面",icon:"fork",component:"CustomSheetList",key:"custom"}];return{activeKey:t[0].key,panes:t}},beforeRouteEnter(t,e,a){const s=t.query.activeKey;a((t=>{s&&(t.activeKey=s)}))},watch:{activeKey(t){if(t){const e=this.$router.history.current.path;this.$router.push({path:e,query:{activeKey:t}}).catch((t=>t))}}}},I=T,L=(0,h.Z)(I,s,i,!1,null,null,null),E=L.exports},52173:function(t,e,a){a.d(e,{Z:function(){return b}});var s=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{afterClose:t.onClosed,bodyStyle:{padding:0},maskClosable:!1,width:680,destroyOnClose:""},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" "+t._s(t.modalTitle)+" "),t.loading?e("a-icon",{attrs:{type:"loading"}}):t._e()]},proxy:!0},{key:"footer",fn:function(){return[t._t("extraFooter"),t.draftSaveVisible?e("ReactiveButton",{attrs:{errored:t.form.draftSaveErrored,loading:t.form.draftSaving,text:(t.hasId?"转为":"保存")+"草稿",erroredText:"保存失败",loadedText:"保存成功",type:"danger"},on:{callback:function(e){return t.handleSavedCallback()},click:function(e){return t.handleSaveDraft()}}}):t._e(),t.publishVisible?e("ReactiveButton",{attrs:{errored:t.form.publishErrored,loading:t.form.publishing,erroredText:"发布失败",loadedText:"发布成功",text:"转为发布"},on:{callback:function(e){return t.handleSavedCallback()},click:function(e){return t.handlePublish()}}}):t._e(),e("ReactiveButton",{attrs:{errored:t.form.saveErrored,erroredText:(t.hasId?"保存":"发布")+"失败",loadedText:(t.hasId?"保存":"发布")+"成功",loading:t.form.saving,text:""+(t.hasId?"保存":"发布")},on:{callback:function(e){return t.handleSavedCallback()},click:function(e){return t.handleSave()}}}),e("a-button",{attrs:{disabled:t.loading},on:{click:function(e){t.modalVisible=!1}}},[t._v("关闭")])]},proxy:!0}],null,!0),model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[e("div",{staticClass:"card-container"},[e("a-tabs",{attrs:{type:"card"}},[e("a-tab-pane",{key:"normal",attrs:{tab:"常规"}},[e("a-form",{attrs:{"label-col":t.form.labelCol,"wrapper-col":t.form.wrapperCol,labelAlign:"left"}},[e("a-form-item",{attrs:{label:"页面标题"}},[e("a-input",{model:{value:t.form.model.title,callback:function(e){t.$set(t.form.model,"title",e)},expression:"form.model.title"}})],1),e("a-form-item",{attrs:{help:t.fullPath,label:"页面别名"}},[e("a-input",{scopedSlots:t._u([{key:"addonAfter",fn:function(){return[e("a-popconfirm",{attrs:{"cancel-text":"取消","ok-text":"确定",placement:"left",title:"是否确定根据标题重新生成别名？"},on:{confirm:t.handleGenerateSlug}},[e("a-icon",{staticClass:"cursor-pointer",attrs:{type:"sync"}})],1)]},proxy:!0}]),model:{value:t.form.model.slug,callback:function(e){t.$set(t.form.model,"slug",e)},expression:"form.model.slug"}})],1),e("a-form-item",{attrs:{label:"摘要"}},[e("a-input",{attrs:{autoSize:{minRows:5},placeholder:"如不填写，会从页面中自动截取",type:"textarea"},model:{value:t.form.model.summary,callback:function(e){t.$set(t.form.model,"summary",e)},expression:"form.model.summary"}})],1)],1)],1),e("a-tab-pane",{key:"advanced",attrs:{tab:"高级"}},[e("a-form",{attrs:{"label-col":t.form.labelCol,"wrapper-col":t.form.wrapperCol,labelAlign:"left"}},[e("a-form-item",{attrs:{label:"禁止评论"}},[e("a-switch",{model:{value:t.form.model.disallowComment,callback:function(e){t.$set(t.form.model,"disallowComment",e)},expression:"form.model.disallowComment"}})],1),e("a-form-item",{attrs:{label:"发表时间："}},[e("a-date-picker",{attrs:{defaultValue:t.createTimeDefaultValue,format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择页面发表时间",showTime:""},on:{change:t.onCreateTimeSelect,ok:t.onCreateTimeSelect}})],1),e("a-form-item",{attrs:{label:"自定义模板："}},[e("a-select",{model:{value:t.form.model.template,callback:function(e){t.$set(t.form.model,"template",e)},expression:"form.model.template"}},[e("a-select-option",{key:"",attrs:{value:""}},[t._v("无")]),t._l(t.templates,(function(a){return e("a-select-option",{key:a,attrs:{value:a}},[t._v(" "+t._s(a)+" ")])}))],2)],1),e("a-form-item",{attrs:{label:"封面图："}},[e("a-space",{attrs:{direction:"vertical"}},[e("img",{staticClass:"w-1/2 cursor-pointer",staticStyle:{"border-radius":"4px"},attrs:{src:t.form.model.thumbnail||"/images/placeholder.jpg",alt:"Sheet cover thumbnail"},on:{click:function(e){t.attachmentSelectVisible=!0}}}),e("a-input",{attrs:{"allow-clear":"",placeholder:"点击封面图选择图片，或者输入外部链接"},model:{value:t.form.model.thumbnail,callback:function(e){t.$set(t.form.model,"thumbnail",e)},expression:"form.model.thumbnail"}})],1)],1)],1)],1),e("a-tab-pane",{key:"seo",attrs:{tab:"SEO"}},[e("a-form",{attrs:{"label-col":t.form.labelCol,"wrapper-col":t.form.wrapperCol,labelAlign:"left"}},[e("a-form-item",{attrs:{label:"自定义关键词"}},[e("a-input",{attrs:{autoSize:{minRows:5},placeholder:"多个关键词以英文逗号隔开",type:"textarea"},model:{value:t.form.model.metaKeywords,callback:function(e){t.$set(t.form.model,"metaKeywords",e)},expression:"form.model.metaKeywords"}})],1),e("a-form-item",{attrs:{label:"自定义描述"}},[e("a-input",{attrs:{autoSize:{minRows:5},placeholder:"如不填写，会从页面中自动截取",type:"textarea"},model:{value:t.form.model.metaDescription,callback:function(e){t.$set(t.form.model,"metaDescription",e)},expression:"form.model.metaDescription"}})],1)],1)],1),e("a-tab-pane",{key:"meta",attrs:{tab:"元数据"}},[e("MetaEditor",{attrs:{metas:t.form.model.metas,targetId:t.form.model.id,target:"sheet"},on:{"update:metas":function(e){return t.$set(t.form.model,"metas",e)}}})],1)],1)],1),e("AttachmentSelectModal",{attrs:{multiSelect:!1,visible:t.attachmentSelectVisible},on:{"update:visible":function(e){t.attachmentSelectVisible=e},confirm:t.handleSelectSheetThumbnail}})],1)},i=[],n=a(8641),l=a(83428),o=a(64203),r=a(80981),d=a.n(r),c=a(20629),m=a(32422),u=a(80068),h={name:"SheetSettingModal",mixins:[l.jB,l.KT],components:{MetaEditor:n.Z},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},sheet:{type:Object,default:()=>({})},savedCallback:{type:Function,default:null}},data(){return{sheetStatuses:m.Zi,form:{model:{},saving:!1,saveErrored:!1,draftSaving:!1,draftSaveErrored:!1,publishing:!1,publishErrored:!1,labelCol:{sm:{span:4},xs:{span:24}},wrapperCol:{sm:{span:20},xs:{span:24}}},templates:[],attachmentSelectVisible:!1}},computed:{...(0,c.Se)(["options"]),modalVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}},modalTitle(){return this.form.model.id?"页面设置":"页面发布"},createTimeDefaultValue(){if(this.form.model.createTime){const t=new Date(this.form.model.createTime);return(0,o._)(t,"YYYY-MM-DD HH:mm:ss")}return(0,o._)(new Date,"YYYY-MM-DD HH:mm:ss")},fullPath(){const{sheet_permalink_type:t,blog_url:e,sheet_prefix:a,path_suffix:s=""}=this.options,{slug:i="{slug}"}=this.form.model;switch(t){case"SECONDARY":return`${e}/${a}/${i}${s}`;case"ROOT":return`${e}/${i}${s}`;default:return""}},hasId(){return!!this.form.model.id},draftSaveVisible(){const{draftSaving:t,publishing:e}=this.form;return(this.form.model.status!==m.Zi.DRAFT.value||!this.hasId||t)&&!e},publishVisible(){const{draftSaving:t,publishing:e}=this.form;return(this.form.model.status===m.Zi.DRAFT.value&&this.hasId||e)&&!t}},watch:{modalVisible(t){t&&(this.form.model=Object.assign({},this.sheet),this.form.model.slug||this.form.model.id||this.handleGenerateSlug())},sheet:{deep:!0,handler(t){this.form.model=Object.assign({},t)}}},created(){this.handleListCustomTemplates()},methods:{async handleCreateOrUpdate(){if(!this.form.model.title)throw this.$notification["error"]({message:"提示",description:"页面标题不能为空！"}),new Error("文章标题不能为空！");this.form.model.keepRaw=!0;try{this.hasId?await u.Z.sheet.update(this.form.model.id,this.form.model):await u.Z.sheet.create(this.form.model)}catch(t){throw this.$log.error(t),new Error(t)}},async handleSave(){try{this.form.saving=!0;const{status:t}=this.form.model;t||(this.form.model.status=this.sheetStatuses.PUBLISHED.value),await this.handleCreateOrUpdate()}catch(t){this.form.saveErrored=!0,this.$log.error("Failed to save sheet",t)}finally{setTimeout((()=>{this.form.saving=!1}),400)}},async handlePublish(){try{this.form.publishing=!0,this.form.model.status=this.sheetStatuses.PUBLISHED.value,await this.handleCreateOrUpdate()}catch(t){this.form.publishErrored=!0,this.$log.error("Failed to publish sheet",t)}finally{setTimeout((()=>{this.form.publishing=!1}),400)}},async handleSaveDraft(){try{this.form.draftSaving=!0,this.form.model.status=this.sheetStatuses.DRAFT.value,await this.handleCreateOrUpdate()}catch(t){this.form.draftSaveErrored=!0,this.$log.error("Failed to save draft sheet",t)}finally{setTimeout((()=>{this.form.draftSaving=!1}),400)}},handleSavedCallback(){this.form.saveErrored||this.form.draftSaveErrored||this.form.publishErrored?(this.form.saveErrored=!1,this.form.draftSaveErrored=!1,this.form.publishErrored=!1):this.savedCallback&&this.savedCallback()},async handleListCustomTemplates(){try{const t=await u.Z.theme.listCustomSheetTemplates();this.templates=t.data}catch(t){this.$log.error(t)}},onCreateTimeSelect(t){this.form.model.createTime=t.valueOf()},handleGenerateSlug(){if(this.form.model.title&&d().isSupported()){let t="";const e=d().parse(this.form.model.title.replace(/\s+/g,"").toLowerCase());let a;e.forEach((e=>{if(2===e.type){const s=e.target?e.target.toLowerCase():"";t+=t&&!/\n|\s/.test(a.target)?"-"+s:s}else t+=(a&&2===a.type?"-":"")+e.target;a=e})),this.$set(this.form.model,"slug",t)}},handleSelectSheetThumbnail({raw:t}){t.length&&(this.form.model.thumbnail=t[0].path),this.attachmentSelectVisible=!1},onClosed(){this.$emit("onClose"),this.$emit("onUpdate",this.form.model)}}},p=h,f=a(1001),g=(0,f.Z)(p,s,i,!1,null,null,null),b=g.exports}}]);